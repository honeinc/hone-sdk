!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Hone=e()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_hreq__,module){"use strict";function Hone(options){var self=this;return EventEmitter.call(self),self.options=extend(!0,{},_defaults,options),self.api=null,self.state=new State({}),self.mongo=Mongo,self.eventBus=new EventBus({namespace:"Hone"}),self.xdls=new XDLS(self.options.xdls),self.xdls.init(),self.id=new Id(self),self._multiplexEmit(self.id,"id"),self.registration=new Registration(self),self._multiplexEmit(self.registration,"registration"),self._multiplexBind(self.registration,["register","unregister","getPerson"]),self.auth=new Auth(self),self._multiplexEmit(self.auth,"auth"),self._multiplexBind(self.auth,["getUser","login","logout","signup","requestLoginCode","updateUser"]),self.preferences=new Preferences(self),self._multiplexEmit(self.preferences,"preferences"),self.objectFactory=objectFactory,self.datastore=new DataStore(self),self._multiplexEmit(self.datastore,"datastore"),self._multiplexBind(self.datastore,["create","get","load"]),self.teams=new Teams(self),self._iframeSizer=new IFrameSizer(self.eventBus),self.options.init&&setTimeout(self.init.bind(self),0),self}var ajaja=_hreq__(2),antisync={parallel:_hreq__(9)},Delver=_hreq__(50),EventEmitter=_hreq__(51).EventEmitter2,EventBus=_hreq__(14),extend=_hreq__(52),XDLS=_hreq__(71),Auth=_hreq__(74),DataStore=_hreq__(75),Id=_hreq__(76),IFrameSizer=_hreq__(77),Mongo=_hreq__(78),objectFactory=_hreq__(79),Preferences=_hreq__(80),Registration=_hreq__(81),State=_hreq__(82).State,Teams=_hreq__(83);module.exports=Hone;var _defaults={domain:"gohone.com:80",xdls:{origin:"https://gohone.com",path:"/xdls.html"},init:!0};Hone.prototype=Object.create(EventEmitter.prototype,{}),Hone.prototype.init=function(callback){var self=this;antisync.parallel([self.auth.getUser.bind(self.auth),self._getAPI.bind(self)],function(error){error&&self.emit("error",error),callback&&callback(error)})},Hone.prototype.url=function(path){return"//"+this.options.domain+path},Hone.prototype._multiplexBind=function(target,methods,namespace){var self=this,selfTarget=self;namespace&&(selfTarget=Delver.get(self,namespace),selfTarget||(selfTarget={},Delver.set(self,namespace,selfTarget))),methods.forEach(function(method){var targetFunction=target[method];if("function"!=typeof targetFunction)throw new Error("Invalid method on target ("+(target.constructor?target.constructor.name:"unknown")+"): "+method);selfTarget[method]=targetFunction.bind(target)})},Hone.prototype._multiplexEmit=function(emitter,namespace){var self=this;emitter.on("error",function(error){window.console.error(error)});var originalEmit=emitter.emit;emitter.emit=function(){originalEmit.apply(emitter,arguments);var args=arguments;if(namespace){args=Array.prototype.slice.call(arguments,0);var eventName=args.shift();eventName=namespace+"."+eventName,args.unshift(eventName)}self.emit.apply(self,args)}},Hone.prototype._getAPI=function(callback){var self=this;ajaja({method:"GET",url:"//"+self.options.domain+"/api/1.0"},function(error,api){self.api=error?null:api,self.api&&self.emit("api_loaded",self.api),callback(error)})},"hone"in window||(window.hone=new Hone)},{14:14,2:2,50:50,51:51,52:52,71:71,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,9:9}],2:[function(_hreq__,module){"use strict";var extend=_hreq__(52),http=_hreq__(20),url=_hreq__(44);module.exports=function(_options,callback){var options=extend(!0,{url:"//"+(_options.host?_options.host:_options.hostname+(_options.port?":"+_options.port:""))+_options.path,responseType:"application/json",headers:{},withCredentials:!0},_options),data=options.data;delete options.data;var parsedURI=url.parse(options.url,!1,!0);delete options.url,options.hostname=options.hostname||parsedURI.hostname,options.port=options.port||parsedURI.port,options.path=options.path||parsedURI.path;var dataString;if("undefined"!=typeof data)if("get"===options.method.toLowerCase()){var pairs=[];for(var key in data)pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(data[key]));options.path+=(-1!==options.path.indexOf("?")?"&":"?")+pairs.join("&")}else try{dataString=JSON.stringify(data),options.headers["Content-Type"]="application/json",options.headers["Content-Length"]=dataString.length}catch(ex){return void(callback&&callback(ex))}var buffer,request=http.request(options,function(response){response.on("error",function(error){callback&&callback(error)}),response.on("data",function(_buffer){buffer=buffer||"",buffer+=_buffer}),response.on("end",function(){if(response.statusCode<200||response.statusCode>=400){var error={code:response.statusCode,error:buffer};return void(callback&&callback(error))}var obj;try{obj=JSON.parse(buffer)}catch(ex){callback&&callback(ex,buffer)}callback&&callback(null,obj)})});dataString&&request.write(dataString),request.end()}},{20:20,44:44,52:52}],3:[function(_hreq__,module){"use strict";var antisync={each:_hreq__(4),eachSeries:_hreq__(5)},utils=_hreq__(12),control=module.exports={};control.limited=function(limit){return function(arr,iterator,callback){if(callback=callback||function(){},!arr.length||0>=limit)return callback();var completed=0,started=0,running=0;!function replenish(){function iterate(err){err?(callback(err),callback=function(){}):(completed+=1,running-=1,completed>=arr.length?callback():replenish())}if(completed>=arr.length)return callback();for(;limit>running&&started<arr.length;)started+=1,running+=1,iterator(arr[started-1],iterate)}()}},control.parallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[antisync.each].concat(args))}},control.parallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[control.limited(limit)].concat(args))}},control.series=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[antisync.eachSeries].concat(args))}},control.iterator=function(tasks){var makeCallback=function(index){var fn=function(){return tasks.length&&tasks[index].apply(null,arguments),fn.next()};return fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null},fn};return makeCallback(0)},control.parallelApply=function(eachfn,tasks,callback){if(callback=callback||function(){},utils.isArray(tasks))eachfn.map(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};eachfn.each(utils.keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}},control.applyEach=function(eachfn,fns){var go=function(){var that=this,args=Array.prototype.slice.call(arguments),callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}return go},control.concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]),cb(err)})},function(err){callback(err,r)})}},{12:12,4:4,5:5}],4:[function(_hreq__,module){"use strict";var utils=_hreq__(12);module.exports=function(arr,iterator,callback){function done(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length&&callback())}if(callback=callback||function(){},!arr.length)return callback();var completed=0;utils.each(arr,function(x){iterator(x,utils.only_once(done))})}},{12:12}],5:[function(_hreq__,module){"use strict";module.exports=function(arr,iterator,callback){if(callback=callback||function(){},!arr.length)return callback();var completed=0;!function iterate(){iterator(arr[completed],function(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length?callback():iterate())})}()}},{}],6:[function(_hreq__,module){"use strict";var control=_hreq__(3),mapper=_hreq__(7);module.exports=control.parallel(mapper)},{3:3,7:7}],7:[function(_hreq__,module){"use strict";var utils=_hreq__(12);module.exports=function(eachfn,arr,iterator,callback){if(arr=utils.map(arr,function(x,i){return{index:i,value:x}}),callback){var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v,callback(err)})},function(err){callback(err,results)})}else eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})}},{12:12}],8:[function(_hreq__,module){"use strict";var control=_hreq__(3),mapper=_hreq__(7);module.exports=control.series(mapper)},{3:3,7:7}],9:[function(_hreq__,module){"use strict";var control=_hreq__(3),antisync={each:_hreq__(4),map:_hreq__(6)};module.exports=function(tasks,callback){control.parallelApply({map:antisync.map,each:antisync.each},tasks,callback)}},{3:3,4:4,6:6}],10:[function(_hreq__,module){"use strict";var utils=_hreq__(12),antisync={mapSeries:_hreq__(8),eachSeries:_hreq__(5)};module.exports=function(tasks,callback){if(callback=callback||function(){},utils.isArray(tasks))antisync.mapSeries(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};antisync.eachSeries(utils.keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}}},{12:12,5:5,8:8}],11:[function(_hreq__,module){(function(process){"use strict";var timing=module.exports={};"undefined"!=typeof process&&process.nextTick?(timing.nextTick=process.nextTick,timing.setImmediate="undefined"!=typeof setImmediate?function(fn){setImmediate(fn)}:timing.nextTick):"function"==typeof setImmediate?(timing.nextTick=function(fn){setImmediate(fn)},timing.setImmediate=timing.nextTick):(timing.nextTick=function(fn){setTimeout(fn,0)},timing.setImmediate=timing.nextTick)}).call(this,_hreq__(26))},{26:26}],12:[function(_hreq__,module){"use strict";function _console_fn(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(err?console.error&&console.error(err):console[name]&&utils.each(args,function(x){console[name](x)}))}]))}}var utils=module.exports={};utils.toString=Object.prototype.toString,utils.isArray=Array.isArray||function(obj){return"[object Array]"===utils.toString.call(obj)},utils.each=function(arr,iterator){for(var i=0;i<arr.length;i+=1)iterator(arr[i],i,arr)},utils.map=function(arr,iterator){if(arr.map)return arr.map(iterator);var results=[];return utils.each(arr,function(x,i,a){results.push(iterator(x,i,a))}),results},utils.reduce=function(arr,iterator,memo){return arr.reduce?arr.reduce(iterator,memo):(utils.each(arr,function(x,i,a){memo=iterator(memo,x,i,a)}),memo)},utils.keys=function(obj){if(Object.keys)return Object.keys(obj);var _keys=[];for(var k in obj)obj.hasOwnProperty(k)&&_keys.push(k);return _keys},utils.only_once=function(fn){var called=!1;return function(){if(called)throw new Error("Callback was already called.");called=!0,fn.apply(null,arguments)}},utils.log=_console_fn("log"),utils.dir=_console_fn("dir")},{}],13:[function(_hreq__,module){"use strict";var control=_hreq__(3),timing=_hreq__(11),utils=_hreq__(12);module.exports=function(tasks,callback){if(callback=callback||function(){},!utils.isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length)return callback();var wrapIterator=function(iterator){return function(err){if(err)callback.apply(null,arguments),callback=function(){};else{var args=Array.prototype.slice.call(arguments,1),next=iterator.next();args.push(next?wrapIterator(next):callback),timing.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(control.iterator(tasks))()}},{11:11,12:12,3:3}],14:[function(_hreq__,module){"use strict";function BrowserEventBus(options){var self=this;EventEmitter.call(self),self._options=extend({namespace:"",target:"*",origin:"*"},options),window.addEventListener("message",self._onMessage.bind(self),!1)}var EventEmitter=_hreq__(51).EventEmitter2,extend=_hreq__(52);module.exports=BrowserEventBus,BrowserEventBus.supported="postMessage"in window&&"bind"in function(){}&&"JSON"in window,BrowserEventBus.prototype=Object.create(EventEmitter.prototype,{}),BrowserEventBus.prototype._emit=BrowserEventBus.prototype.emit,BrowserEventBus.prototype.emit=function(){for(var self=this,args=Array.prototype.slice.call(arguments,0),event=(self._options.namespace?self._options.namespace+":":"")+JSON.stringify(args),targets=Array.prototype.slice.call(window.frames,0),win=window===window.parent?null:window.parent;win;)targets.push(win),win=win===win.parent?null:win.parent;targets.forEach(function(target){target!==window&&target.postMessage(event,self._options.target)})},BrowserEventBus.prototype._onMessage=function(event){var self=this;if(!(self._options.namespace&&0!==event.data.indexOf(self._options.namespace)||"*"!==self._options.origin&&event.origin!==self._options.origin)){var json=event.data.slice(self._options.namespace?self._options.namespace.length+1:0),msg=null;try{msg=JSON.parse(json)}catch(ex){return msg=null,void self._emit("error","browser-event-bus: "+ex)}if(!Array.isArray(msg))return void self._emit("error",new Error("browser-event-bus: Did not get an array from event: "+event.data));msg.push(event),self._emit.apply(self,msg)}}},{51:51,52:52}],15:[function(_hreq__,module,exports){function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var length,type=typeof subject;if("number"===type)length=subject>0?subject>>>0:0;else if("string"===type)"base64"===encoding&&(subject=base64clean(subject)),length=Buffer.byteLength(subject,encoding);else{if("object"!==type||null===subject)throw new TypeError("must start with number, buffer, array or string");"Buffer"===subject.type&&isArray(subject.data)&&(subject=subject.data),length=+subject.length>0?Math.floor(+subject.length):0}if(this.length>kMaxLength)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength.toString(16)+" bytes");var buf;Buffer.TYPED_ARRAY_SUPPORT?buf=Buffer._augment(new Uint8Array(length)):(buf=this,buf.length=length,buf._isBuffer=!0);var i;if(Buffer.TYPED_ARRAY_SUPPORT&&"number"==typeof subject.byteLength)buf._set(subject);else if(isArrayish(subject))if(Buffer.isBuffer(subject))for(i=0;length>i;i++)buf[i]=subject.readUInt8(i);else for(i=0;length>i;i++)buf[i]=(subject[i]%256+256)%256;else if("string"===type)buf.write(subject,0,encoding);else if("number"===type&&!Buffer.TYPED_ARRAY_SUPPORT&&!noZero)for(i=0;length>i;i++)buf[i]=0;return buf}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var byte=parseInt(string.substr(2*i,2),16);if(isNaN(byte))throw new Error("Invalid hex string");buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length,2);return charsWritten}function base64Slice(buf,start,end){return base64.fromByteArray(0===start&&end===buf.length?buf:buf.slice(start,end))}function utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function binarySlice(buf,start,end){return asciiSlice(buf,start,end)}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||min>value)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){for(str=stringtrim(str).replace(INVALID_BASE64_RE,"");str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&"object"==typeof subject&&"number"==typeof subject.length}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(str){for(var byteArray=[],i=0;i<str.length;i++){var b=str.charCodeAt(i);if(127>=b)byteArray.push(b);else{var start=i;b>=55296&&57343>=b&&i++;for(var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%"),j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str){for(var c,hi,lo,byteArray=[],i=0;i<str.length;i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length,unitSize){unitSize&&(length-=length%unitSize);for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}var base64=_hreq__(16),ieee754=_hreq__(17),isArray=_hreq__(18);exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var kMaxLength=1073741823;Buffer.TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0),arr=new Uint8Array(buf);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(e){return!1}}(),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];i++);return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,totalLength){if(!isArray(list))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if(void 0===totalLength)for(totalLength=0,i=0;i<list.length;i++)totalLength+=list[i].length;var buf=new Buffer(totalLength),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=function(str,encoding){var ret;switch(str+="",encoding||"utf8"){case"ascii":case"binary":case"raw":ret=str.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=2*str.length;break;case"hex":ret=str.length>>>1;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"base64":ret=base64ToBytes(str).length;break;default:ret=str.length}return ret},Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0,Buffer.prototype.toString=function(encoding,start,end){var loweredCase=!1;if(start>>>=0,end=void 0===end||1/0===end?this.length:end>>>0,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return 0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset))isFinite(length)||(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=length,length=swap}offset=Number(offset)||0;var remaining=this.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining,encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new TypeError("Unknown encoding: "+encoding)}return ret},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(start,end){var len=this.length;if(start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)return Buffer._augment(this.subarray(start,end));for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0,!0),i=0;sliceLen>i;i++)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(start||(start=0),end||0===end||(end=this.length),target_start||(target_start=0),end!==start&&0!==target.length&&0!==source.length){if(start>end)throw new TypeError("sourceEnd < sourceStart");if(0>target_start||target_start>=target.length)throw new TypeError("targetStart out of bounds");if(0>start||start>=source.length)throw new TypeError("sourceStart out of bounds");if(0>end||end>source.length)throw new TypeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-target_start<end-start&&(end=target.length-target_start+start);var len=end-start;if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;len>i;i++)target[i+target_start]=this[i+start];else target._set(this.subarray(start,start+len),target_start)}},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new TypeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new TypeError("start out of bounds");if(0>end||end>this.length)throw new TypeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;
else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._get=arr.get,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g},{16:16,17:17,18:18}],16:[function(_hreq__,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS?62:code===SLASH?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],17:[function(_hreq__,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?0/0:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||1/0===value?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],18:[function(_hreq__,module){var isArray=Array.isArray,str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],19:[function(_hreq__,module){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],20:[function(_hreq__,module){var http=module.exports,Request=(_hreq__(19).EventEmitter,_hreq__(21)),url=_hreq__(44);http.request=function(params,cb){"string"==typeof params&&(params=url.parse(params)),params||(params={}),params.host||params.port||(params.port=parseInt(window.location.port,10)),!params.host&&params.hostname&&(params.host=params.hostname),params.protocol||(params.protocol=params.scheme?params.scheme+":":window.location.protocol),params.host||(params.host=window.location.hostname||window.location.host),/:/.test(params.host)&&(params.port||(params.port=params.host.split(":")[1]),params.host=params.host.split(":")[0]),params.port||(params.port="https:"==params.protocol?443:80);var req=new Request(new xhrHttp,params);return cb&&req.on("response",cb),req},http.get=function(params,cb){params.method="GET";var req=http.request(params,cb);return req.end(),req},http.Agent=function(){},http.Agent.defaultMaxSockets=4;var xhrHttp=function(){if("undefined"==typeof window)throw new Error("no window object present");if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject){for(var axs=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],i=0;i<axs.length;i++)try{var ax=new window.ActiveXObject(axs[i]);return function(){if(ax){var ax_=ax;return ax=null,ax_}return new window.ActiveXObject(axs[i])}}catch(e){}throw new Error("ajax not supported in this browser")}throw new Error("ajax not supported in this browser")}();http.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{19:19,21:21,44:44}],21:[function(_hreq__,module){var Stream=_hreq__(42),Response=_hreq__(22),Base64=_hreq__(23),inherits=_hreq__(24),Request=module.exports=function(xhr,params){var self=this;self.writable=!0,self.xhr=xhr,self.body=[],self.uri=(params.protocol||"http:")+"//"+params.host+(params.port?":"+params.port:"")+(params.path||"/"),"undefined"==typeof params.withCredentials&&(params.withCredentials=!0);try{xhr.withCredentials=params.withCredentials}catch(e){}if(params.responseType)try{xhr.responseType=params.responseType}catch(e){}if(xhr.open(params.method||"GET",self.uri,!0),xhr.onerror=function(){self.emit("error",new Error("Network error"))},self._headers={},params.headers)for(var keys=objectKeys(params.headers),i=0;i<keys.length;i++){var key=keys[i];if(self.isSafeRequestHeader(key)){var value=params.headers[key];self.setHeader(key,value)}}params.auth&&this.setHeader("Authorization","Basic "+Base64.btoa(params.auth));var res=new Response;res.on("close",function(){self.emit("close")}),res.on("ready",function(){self.emit("response",res)}),res.on("error",function(err){self.emit("error",err)}),xhr.onreadystatechange=function(){xhr.__aborted||res.handle(xhr)}};inherits(Request,Stream),Request.prototype.setHeader=function(key,value){this._headers[key.toLowerCase()]=value},Request.prototype.getHeader=function(key){return this._headers[key.toLowerCase()]},Request.prototype.removeHeader=function(key){delete this._headers[key.toLowerCase()]},Request.prototype.write=function(s){this.body.push(s)},Request.prototype.destroy=function(){this.xhr.__aborted=!0,this.xhr.abort(),this.emit("close")},Request.prototype.end=function(s){void 0!==s&&this.body.push(s);for(var keys=objectKeys(this._headers),i=0;i<keys.length;i++){var key=keys[i],value=this._headers[key];if(isArray(value))for(var j=0;j<value.length;j++)this.xhr.setRequestHeader(key,value[j]);else this.xhr.setRequestHeader(key,value)}if(0===this.body.length)this.xhr.send("");else if("string"==typeof this.body[0])this.xhr.send(this.body.join(""));else if(isArray(this.body[0])){for(var body=[],i=0;i<this.body.length;i++)body.push.apply(body,this.body[i]);this.xhr.send(body)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(var len=0,i=0;i<this.body.length;i++)len+=this.body[i].length;for(var body=new this.body[0].constructor(len),k=0,i=0;i<this.body.length;i++)for(var b=this.body[i],j=0;j<b.length;j++)body[k++]=b[j];this.xhr.send(body)}else if(isXHR2Compatible(this.body[0]))this.xhr.send(this.body[0]);else{for(var body="",i=0;i<this.body.length;i++)body+=this.body[i].toString();this.xhr.send(body)}},Request.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],Request.prototype.isSafeRequestHeader=function(headerName){return headerName?-1===indexOf(Request.unsafeHeaders,headerName.toLowerCase()):!1};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},indexOf=function(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++)if(xs[i]===x)return i;return-1},isXHR2Compatible=function(obj){return"undefined"!=typeof Blob&&obj instanceof Blob?!0:"undefined"!=typeof ArrayBuffer&&obj instanceof ArrayBuffer?!0:"undefined"!=typeof FormData&&obj instanceof FormData?!0:void 0}},{22:22,23:23,24:24,42:42}],22:[function(_hreq__,module){function parseHeaders(res){for(var lines=res.getAllResponseHeaders().split(/\r?\n/),headers={},i=0;i<lines.length;i++){var line=lines[i];if(""!==line){var m=line.match(/^([^:]+):\s*(.*)/);if(m){var key=m[1].toLowerCase(),value=m[2];void 0!==headers[key]?isArray(headers[key])?headers[key].push(value):headers[key]=[headers[key],value]:headers[key]=value}else headers[line]=!0}}return headers}var Stream=_hreq__(42),util=_hreq__(46),Response=module.exports=function(){this.offset=0,this.readable=!0};util.inherits(Response,Stream);var capable={streaming:!0,status2:!0};Response.prototype.getResponse=function(xhr){var respType=String(xhr.responseType).toLowerCase();return"blob"===respType?xhr.responseBlob||xhr.response:"arraybuffer"===respType?xhr.response:xhr.responseText},Response.prototype.getHeader=function(key){return this.headers[key.toLowerCase()]},Response.prototype.handle=function(res){if(2===res.readyState&&capable.status2){try{this.statusCode=res.status,this.headers=parseHeaders(res)}catch(err){capable.status2=!1}capable.status2&&this.emit("ready")}else if(capable.streaming&&3===res.readyState){try{this.statusCode||(this.statusCode=res.status,this.headers=parseHeaders(res),this.emit("ready"))}catch(err){}try{this._emitData(res)}catch(err){capable.streaming=!1}}else 4===res.readyState&&(this.statusCode||(this.statusCode=res.status,this.emit("ready")),this._emitData(res),res.error?this.emit("error",this.getResponse(res)):this.emit("end"),this.emit("close"))},Response.prototype._emitData=function(res){var respBody=this.getResponse(res);return respBody.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(respBody,this.offset)),void(this.offset=respBody.byteLength)):void(respBody.length>this.offset&&(this.emit("data",respBody.slice(this.offset)),this.offset=respBody.length))};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{42:42,46:46}],23:[function(_hreq__,module,exports){!function(){function InvalidCharacterError(message){this.message=message}var object="undefined"!=typeof exports?exports:this,chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",object.btoa||(object.btoa=function(input){for(var block,charCode,idx=0,map=chars,output="";input.charAt(0|idx)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){if(charCode=input.charCodeAt(idx+=.75),charCode>255)throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");block=block<<8|charCode}return output}),object.atob||(object.atob=function(input){if(input=input.replace(/=+$/,""),input.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var bs,buffer,bc=0,idx=0,output="";buffer=input.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer=chars.indexOf(buffer);return output})}()},{}],24:[function(_hreq__,module){module.exports="function"==typeof Object.create?function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],25:[function(_hreq__,module){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],26:[function(_hreq__,module){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canMutationObserver="undefined"!=typeof window&&window.MutationObserver,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div"),observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0,queueList.forEach(function(fn){fn()})});return observer.observe(hiddenDiv,{attributes:!0}),function(fn){queue.length||hiddenDiv.setAttribute("yes","no"),queue.push(fn)}}return canPost?(window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}):function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")}},{}],27:[function(_hreq__,module,exports){(function(global){!function(root){function error(type){throw RangeError(errors[type])}function map(array,fn){for(var length=array.length;length--;)array[length]=fn(array[length]);return array}function mapDomain(string,fn){return map(string.split(regexSeparators),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),value>=55296&&56319>=value&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return 10>codePoint-48?codePoint-22:26>codePoint-65?codePoint-65:26>codePoint-97?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(26>digit)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for(basic=input.lastIndexOf(delimiter),0>basic&&(basic=0),j=0;basic>j;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;inputLength>index;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>digit);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;inputLength>j;++j)currentValue=input[j],128>currentValue&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);inputLength>handledCPCount;){for(m=maxInt,j=0;inputLength>j;++j)currentValue=input[j],currentValue>=n&&m>currentValue&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;inputLength>j;++j)if(currentValue=input[j],n>currentValue&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>q);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(domain){return mapDomain(domain,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(domain){return mapDomain(domain,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}var freeExports="object"==typeof exports&&exports,freeModule="object"==typeof module&&module&&module.exports==freeExports&&module,freeGlobal="object"==typeof global&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)&&(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^ -~]/,regexSeparators=/\x2E|\u3002|\uFF0E|\uFF61/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;if(punycode={version:"1.2.4",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(_hreq__,module){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;len>i;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],29:[function(_hreq__,module){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],30:[function(_hreq__,module,exports){"use strict";exports.decode=exports.parse=_hreq__(28),exports.encode=exports.stringify=_hreq__(29)},{28:28,29:29}],31:[function(_hreq__,module){module.exports=_hreq__(32)},{32:32}],32:[function(_hreq__,module){(function(process){function Duplex(options){return this instanceof Duplex?(Readable.call(this,options),Writable.call(this,options),options&&options.readable===!1&&(this.readable=!1),options&&options.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,options&&options.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(options)}function onend(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},util=_hreq__(37);util.inherits=_hreq__(24);var Readable=_hreq__(34),Writable=_hreq__(36);util.inherits(Duplex,Readable),forEach(objectKeys(Writable.prototype),function(method){Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])})}).call(this,_hreq__(26))},{24:24,26:26,34:34,36:36,37:37}],33:[function(_hreq__,module){function PassThrough(options){return this instanceof PassThrough?void Transform.call(this,options):new PassThrough(options)}module.exports=PassThrough;var Transform=_hreq__(35),util=_hreq__(37);util.inherits=_hreq__(24),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{24:24,35:35,37:37}],34:[function(_hreq__,module){(function(process){function ReadableState(options){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||0===hwm?hwm:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!options.objectMode,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=_hreq__(43).StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){return this instanceof Readable?(this._readableState=new ReadableState(options,this),this.readable=!0,void Stream.call(this)):new Readable(options)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(null===chunk||void 0===chunk)state.reading=!1,state.ended||onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk)),state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):(state.reading=!1,state.buffer.push(chunk)),state.needReadable&&emitReadable(stream),maybeReadMore(stream,state);else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function roundUpToNextPowerOf2(n){if(n>=MAX_HWM)n=MAX_HWM;else{n--;for(var p=1;32>p;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){return 0===state.length&&state.ended?0:state.objectMode?0===n?0:1:null===n||isNaN(n)?state.flowing&&state.buffer.length?state.buffer[0].length:state.length:0>=n?0:(n>state.highWaterMark&&(state.highWaterMark=roundUpToNextPowerOf2(n)),n>state.length?state.ended?state.length:(state.needReadable=!0,0):n)
}function chunkInvalid(state,chunk){var er=null;return Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,state.length>0?emitReadable(stream):endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(state.emittedReadable=!0,state.sync?process.nextTick(function(){emitReadable_(stream)}):emitReadable_(stream))}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,process.nextTick(function(){maybeReadMore_(stream,state)}))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;state.awaitDrain--,0===state.awaitDrain&&flow(src)}}function flow(src){function write(dest){var written=dest.write(chunk);!1===written&&state.awaitDrain++}var chunk,state=src._readableState;for(state.awaitDrain=0;state.pipesCount&&null!==(chunk=src.read());)if(1===state.pipesCount?write(state.pipes,0,null):forEach(state.pipes,write),src.emit("data",chunk),state.awaitDrain>0)return;return 0===state.pipesCount?(state.flowing=!1,void(EE.listenerCount(src,"data")>0&&emitDataEvents(src))):void(state.ranOut=!0)}function pipeOnReadable(){this._readableState.ranOut&&(this._readableState.ranOut=!1,flow(this))}function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing)throw new Error("Cannot switch to old mode now.");var paused=startPaused||!1,readable=!1;stream.readable=!0,stream.pipe=Stream.prototype.pipe,stream.on=stream.addListener=Stream.prototype.on,stream.on("readable",function(){readable=!0;for(var c;!paused&&null!==(c=stream.read());)stream.emit("data",c);null===c&&(readable=!1,stream._readableState.needReadable=!0)}),stream.pause=function(){paused=!0,this.emit("pause")},stream.resume=function(){paused=!1,readable?process.nextTick(function(){stream.emit("readable")}):this.read(0),this.emit("resume")},stream.emit("readable")}function fromList(n,state){var ret,list=state.buffer,length=state.length,stringMode=!!state.decoder,objectMode=!!state.objectMode;if(0===list.length)return null;if(0===length)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length)ret=stringMode?list.join(""):Buffer.concat(list,length),list.length=0;else if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n),list[0]=buf.slice(n)}else if(n===list[0].length)ret=list.shift();else{ret=stringMode?"":new Buffer(n);for(var c=0,i=0,l=list.length;l>i&&n>c;i++){var buf=list[0],cpy=Math.min(n-c,buf.length);stringMode?ret+=buf.slice(0,cpy):buf.copy(ret,c,0,cpy),cpy<buf.length?list[0]=buf.slice(cpy):list.shift(),c+=cpy}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");!state.endEmitted&&state.calledRead&&(state.ended=!0,process.nextTick(function(){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}function indexOf(xs,x){for(var i=0,l=xs.length;l>i;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var isArray=_hreq__(25),Buffer=_hreq__(15).Buffer;Readable.ReadableState=ReadableState;var EE=_hreq__(19).EventEmitter;EE.listenerCount||(EE.listenerCount=function(emitter,type){return emitter.listeners(type).length});var Stream=_hreq__(42),util=_hreq__(37);util.inherits=_hreq__(24);var StringDecoder;util.inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return"string"!=typeof chunk||state.objectMode||(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=new Buffer(chunk,encoding),encoding="")),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",!0)},Readable.prototype.setEncoding=function(enc){StringDecoder||(StringDecoder=_hreq__(43).StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc};var MAX_HWM=8388608;Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=!0;var ret,nOrig=n;if(("number"!=typeof n||n>0)&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return emitReadable(this),null;if(n=howMuchToRead(n,state),0===n&&state.ended)return ret=null,state.length>0&&state.decoder&&(ret=fromList(n,state),state.length-=ret.length),0===state.length&&endReadable(this),ret;var doRead=state.needReadable;return state.length-n<=state.highWaterMark&&(doRead=!0),(state.ended||state.reading)&&(doRead=!1),doRead&&(state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1),doRead&&!state.reading&&(n=howMuchToRead(nOrig,state)),ret=n>0?fromList(n,state):null,null===ret&&(state.needReadable=!0,n=0),state.length-=n,0!==state.length||state.ended||(state.needReadable=!0),state.ended&&!state.endEmitted&&0===state.length&&endReadable(this),ret},Readable.prototype._read=function(){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){readable===src&&cleanup()}function onend(){dest.end()}function cleanup(){dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),(!dest._writableState||dest._writableState.needDrain)&&ondrain()}function onerror(er){unpipe(),dest.removeListener("error",onerror),0===EE.listenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){dest.removeListener("close",onclose),unpipe()}function unpipe(){src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:cleanup;state.endEmitted?process.nextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);return dest.on("drain",ondrain),dest._events&&dest._events.error?isArray(dest._events.error)?dest._events.error.unshift(onerror):dest._events.error=[onerror,dest._events.error]:dest.on("error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(this.on("readable",pipeOnReadable),state.flowing=!0,process.nextTick(function(){flow(src)})),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,this.removeListener("readable",pipeOnReadable),state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,this.removeListener("readable",pipeOnReadable),state.flowing=!1;for(var i=0;len>i;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"!==ev||this._readableState.flowing||emitDataEvents(this),"readable"===ev&&this.readable){var state=this._readableState;state.readableListening||(state.readableListening=!0,state.emittedReadable=!1,state.needReadable=!0,state.reading?state.length&&emitReadable(this,state):this.read(0))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){emitDataEvents(this),this.read(0),this.emit("resume")},Readable.prototype.pause=function(){emitDataEvents(this,!0),this.emit("pause")},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){var ret=self.push(chunk);ret||(paused=!0,stream.pause())}});for(var i in stream)"function"==typeof stream[i]&&"undefined"==typeof this[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));var events=["error","close","destroy","pause","resume"];return forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(){paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,_hreq__(26))},{15:15,19:19,24:24,25:25,26:26,37:37,42:42,43:43}],35:[function(_hreq__,module){function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb&&cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var stream=(this._transformState=new TransformState(options,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=(stream._readableState,stream._transformState);if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=_hreq__(32),util=_hreq__(37);util.inherits=_hreq__(24),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(){throw new Error("not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{24:24,32:32,37:37}],36:[function(_hreq__,module){(function(process){function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||0===hwm?hwm:16384,this.objectMode=!!options.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function Writable(options){var Duplex=_hreq__(32);return this instanceof Writable||this instanceof Duplex?(this._writableState=new WritableState(options,this),this.writable=!0,void Stream.call(this)):new Writable(options)}function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er),process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=!0;if(!Buffer.isBuffer(chunk)&&"string"!=typeof chunk&&null!==chunk&&void 0!==chunk&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er),process.nextTick(function(){cb(er)}),valid=!1}return valid}function decodeChunk(state,chunk,encoding){return state.objectMode||state.decodeStrings===!1||"string"!=typeof chunk||(chunk=new Buffer(chunk,encoding)),chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;return ret||(state.needDrain=!0),state.writing?state.buffer.push(new WriteReq(chunk,encoding,cb)):doWrite(stream,state,len,chunk,encoding,cb),ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){sync?process.nextTick(function(){cb(er)}):cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);finished||state.bufferProcessing||!state.buffer.length||clearBuffer(stream,state),sync?process.nextTick(function(){afterWrite(stream,state,finished,cb)}):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),cb(),finished&&finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c],chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback,len=state.objectMode?1:chunk.length;if(doWrite(stream,state,len,chunk,encoding,cb),state.writing){c++;break}}state.bufferProcessing=!1,c<state.buffer.length?state.buffer=state.buffer.slice(c):state.buffer.length=0}function needFinish(stream,state){return state.ending&&0===state.length&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);return need&&(state.finished=!0,stream.emit("finish")),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?process.nextTick(cb):stream.once("finish",cb)),state.ended=!0}module.exports=Writable;var Buffer=_hreq__(15).Buffer;Writable.WritableState=WritableState;var util=_hreq__(37);util.inherits=_hreq__(24);var Stream=_hreq__(42);util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),Buffer.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=function(){}),state.ended?writeAfterEnd(this,state,cb):validChunk(this,state,chunk,cb)&&(ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),"undefined"!=typeof chunk&&null!==chunk&&this.write(chunk,encoding),state.ending||state.finished||endWritable(this,state,cb)}}).call(this,_hreq__(26))},{15:15,24:24,26:26,32:32,37:37,42:42}],37:[function(_hreq__,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function isBuffer(arg){return Buffer.isBuffer(arg)}function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=isBuffer}).call(this,_hreq__(15).Buffer)},{15:15}],38:[function(_hreq__,module){module.exports=_hreq__(33)},{33:33}],39:[function(_hreq__,module,exports){var Stream=_hreq__(42);exports=module.exports=_hreq__(34),exports.Stream=Stream,exports.Readable=exports,exports.Writable=_hreq__(36),exports.Duplex=_hreq__(32),exports.Transform=_hreq__(35),exports.PassThrough=_hreq__(33)},{32:32,33:33,34:34,35:35,36:36,42:42}],40:[function(_hreq__,module){module.exports=_hreq__(35)},{35:35}],41:[function(_hreq__,module){module.exports=_hreq__(36)},{36:36}],42:[function(_hreq__,module){function Stream(){EE.call(this)}module.exports=Stream;var EE=_hreq__(19).EventEmitter,inherits=_hreq__(24);inherits(Stream,EE),Stream.Readable=_hreq__(39),Stream.Writable=_hreq__(41),Stream.Duplex=_hreq__(31),Stream.Transform=_hreq__(40),Stream.PassThrough=_hreq__(38),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&options.end===!1||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{19:19,24:24,31:31,38:38,39:39,40:40,41:41}],43:[function(_hreq__,module,exports){function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}var Buffer=_hreq__(15).Buffer,isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";buffer=buffer.slice(available,buffer.length),charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(!(charCode>=55296&&56319>=charCode)){if(this.charReceived=this.charLength=0,0===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);var end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived),charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1,charCode=charStr.charCodeAt(end);if(charCode>=55296&&56319>=charCode){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=buffer.length>=3?3:buffer.length;i>0;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(2>=i&&c>>4==14){this.charLength=3;break}if(3>=i&&c>>3==30){this.charLength=4;break}}this.charReceived=i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res}},{15:15}],44:[function(_hreq__,module,exports){function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}function isString(arg){return"string"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}var punycode=_hreq__(27);exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=_hreq__(30);Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}var auth,atSign;atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),-1!==atSign&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;l>i;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;k>j;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}if(this.hostname=this.hostname.length>hostnameMaxLen?"":this.hostname.toLowerCase(),!ipv6Hostname){for(var domainArray=this.hostname.split("."),newOut=[],i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;l>i;i++){var ae=autoEscape[i],esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}var result=new Url;if(Object.keys(this).forEach(function(k){result[k]=this[k]},this),result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol)return Object.keys(relative).forEach(function(k){"protocol"!==k&&(result[k]=relative[k])}),slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result;if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol])return Object.keys(relative).forEach(function(k){result[k]=relative[k]}),result.href=result.format(),result;if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;
authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.path=result.search?"/"+result.search:null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."==last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{27:27,30:30}],45:[function(_hreq__,module){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],46:[function(_hreq__,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str){return str}function arrayToHash(array){var hash={};return array.forEach(function(val){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)output.push(hasOwnProperty(value,String(i))?formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0):"");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=_hreq__(45);var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=_hreq__(24),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,_hreq__(26),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{24:24,26:26,45:45}],47:[function(_hreq__,module){module.exports=function(obj){return!(null==obj||!obj.constructor||"function"!=typeof obj.constructor.isBuffer||!obj.constructor.isBuffer(obj))}},{}],48:[function(_hreq__,module){(function(process){function ObjectID(arg){if(!(this instanceof ObjectID))return new ObjectID(arg);if(arg&&(arg instanceof ObjectID||"ObjectID"===arg._bsontype))return arg;var buf;if(isBuffer(arg)||Array.isArray(arg)&&12===arg.length)buf=Array.prototype.slice.call(arg);else if("string"==typeof arg){if(12!==arg.length&&!ObjectID.isValid(arg))throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");buf=buffer(arg)}else/number|undefined/.test(typeof arg)&&(buf=buffer(generate(arg)));Object.defineProperty(this,"id",{get:function(){return String.fromCharCode.apply(this,buf)}}),Object.defineProperty(this,"str",{get:function(){return buf.map(hex.bind(this,2)).join("")}})}function next(){return index=(index+1)%16777215}function generate(time){return"number"!=typeof time&&(time=Date.now()/1e3),time=parseInt(time,10)%4294967295,hex(8,time)+hex(6,MACHINE_ID)+hex(4,pid)+hex(6,next())}function hex(length,n){return n=n.toString(16),n.length===length?n:"00000000".substring(n.length,length)+n}function buffer(str){var i=0,out=[];if(24===str.length)for(;24>i;out.push(parseInt(str[i]+str[i+1],16)),i+=2);else if(12===str.length)for(;12>i;out.push(str.charCodeAt(i)),i++);return out}var MACHINE_ID=parseInt(16777215*Math.random(),10),index=ObjectID.index=parseInt(16777215*Math.random(),10),pid="undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid%65535,isBuffer=_hreq__(47);module.exports=ObjectID,ObjectID.generate=generate,ObjectID.createFromTime=function(time){return time=parseInt(time,10)%4294967295,new ObjectID(hex(8,time)+"0000000000000000")},ObjectID.createFromHexString=function(hexString){if(!ObjectID.isValid(hexString))throw new Error("Invalid ObjectID hex string");return new ObjectID(hexString)},ObjectID.isValid=function(objectid){return objectid?/^[0-9A-F]{24}$/i.test(objectid.toString()):!1},ObjectID.prototype={_bsontype:"ObjectID",toHexString:function(){return this.str},equals:function(other){return!!other&&this.str===other.toString()},getTimestamp:function(){return new Date(1e3*parseInt(this.str.substr(0,8),16))}},ObjectID.prototype.inspect=function(){return"ObjectID("+this+")"},ObjectID.prototype.toJSON=ObjectID.prototype.toHexString,ObjectID.prototype.toString=ObjectID.prototype.toHexString}).call(this,_hreq__(26))},{26:26,47:47}],49:[function(_hreq__,module,exports){(function(global){!function(undefined){"use strict";function inherits(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}function Diff(kind,path){Object.defineProperty(this,"kind",{value:kind,enumerable:!0}),path&&path.length&&Object.defineProperty(this,"path",{value:path,enumerable:!0})}function DiffEdit(path,origin,value){DiffEdit.super_.call(this,"E",path),Object.defineProperty(this,"lhs",{value:origin,enumerable:!0}),Object.defineProperty(this,"rhs",{value:value,enumerable:!0})}function DiffNew(path,value){DiffNew.super_.call(this,"N",path),Object.defineProperty(this,"rhs",{value:value,enumerable:!0})}function DiffDeleted(path,value){DiffDeleted.super_.call(this,"D",path),Object.defineProperty(this,"lhs",{value:value,enumerable:!0})}function DiffArray(path,index,item){DiffArray.super_.call(this,"A",path),Object.defineProperty(this,"index",{value:index,enumerable:!0}),Object.defineProperty(this,"item",{value:item,enumerable:!0})}function arrayRemove(arr,from,to){var rest=arr.slice((to||from)+1||arr.length);return arr.length=0>from?arr.length+from:from,arr.push.apply(arr,rest),arr}function deepDiff(lhs,rhs,changes,prefilter,path,key,stack){path=path||[];var currentPath=path.slice(0);if("undefined"!=typeof key){if(prefilter&&prefilter(currentPath,key))return;currentPath.push(key)}var ltype=typeof lhs,rtype=typeof rhs;if("undefined"===ltype)"undefined"!==rtype&&changes(new DiffNew(currentPath,rhs));else if("undefined"===rtype)changes(new DiffDeleted(currentPath,lhs));else if(ltype!==rtype)changes(new DiffEdit(currentPath,lhs,rhs));else if(lhs instanceof Date&&rhs instanceof Date&&lhs-rhs!==0)changes(new DiffEdit(currentPath,lhs,rhs));else if("object"===ltype&&null!==lhs&&null!==rhs){if(stack=stack||[],stack.indexOf(lhs)<0){if(stack.push(lhs),Array.isArray(lhs)){{var i;lhs.length}for(i=0;i<lhs.length;i++)i>=rhs.length?changes(new DiffArray(currentPath,i,new DiffDeleted(undefined,lhs[i]))):deepDiff(lhs[i],rhs[i],changes,prefilter,currentPath,i,stack);for(;i<rhs.length;)changes(new DiffArray(currentPath,i,new DiffNew(undefined,rhs[i++])))}else{var akeys=Object.keys(lhs),pkeys=Object.keys(rhs);akeys.forEach(function(k){var other=pkeys.indexOf(k);other>=0?(deepDiff(lhs[k],rhs[k],changes,prefilter,currentPath,k,stack),pkeys=arrayRemove(pkeys,other)):deepDiff(lhs[k],undefined,changes,prefilter,currentPath,k,stack)}),pkeys.forEach(function(k){deepDiff(undefined,rhs[k],changes,prefilter,currentPath,k,stack)})}stack.length=stack.length-1}}else lhs!==rhs&&("number"===ltype&&isNaN(lhs)&&isNaN(rhs)||changes(new DiffEdit(currentPath,lhs,rhs)))}function accumulateDiff(lhs,rhs,prefilter,accum){return accum=accum||[],deepDiff(lhs,rhs,function(diff){diff&&accum.push(diff)},prefilter),accum.length?accum:undefined}function applyArrayChange(arr,index,change){if(change.path&&change.path.length){var i,it=arr[index],u=change.path.length-1;for(i=0;u>i;i++)it=it[change.path[i]];switch(change.kind){case"A":applyArrayChange(it[change.path[i]],change.index,change.item);break;case"D":delete it[change.path[i]];break;case"E":case"N":it[change.path[i]]=change.rhs}}else switch(change.kind){case"A":applyArrayChange(arr[index],change.index,change.item);break;case"D":arr=arrayRemove(arr,index);break;case"E":case"N":arr[index]=change.rhs}return arr}function applyChange(target,source,change){if(target&&source&&change&&change.kind){for(var it=target,i=-1,last=change.path.length-1;++i<last;)"undefined"==typeof it[change.path[i]]&&(it[change.path[i]]="number"==typeof change.path[i]?new Array:{}),it=it[change.path[i]];switch(change.kind){case"A":applyArrayChange(it[change.path[i]],change.index,change.item);break;case"D":delete it[change.path[i]];break;case"E":case"N":it[change.path[i]]=change.rhs}}}function revertArrayChange(arr,index,change){if(change.path&&change.path.length){var i,it=arr[index],u=change.path.length-1;for(i=0;u>i;i++)it=it[change.path[i]];switch(change.kind){case"A":revertArrayChange(it[change.path[i]],change.index,change.item);break;case"D":it[change.path[i]]=change.lhs;break;case"E":it[change.path[i]]=change.lhs;break;case"N":delete it[change.path[i]]}}else switch(change.kind){case"A":revertArrayChange(arr[index],change.index,change.item);break;case"D":arr[index]=change.lhs;break;case"E":arr[index]=change.lhs;break;case"N":arr=arrayRemove(arr,index)}return arr}function revertChange(target,source,change){if(target&&source&&change&&change.kind){var i,u,it=target;for(u=change.path.length-1,i=0;u>i;i++)"undefined"==typeof it[change.path[i]]&&(it[change.path[i]]={}),it=it[change.path[i]];switch(change.kind){case"A":revertArrayChange(it[change.path[i]],change.index,change.item);break;case"D":it[change.path[i]]=change.lhs;break;case"E":it[change.path[i]]=change.lhs;break;case"N":delete it[change.path[i]]}}}function applyDiff(target,source,filter){if(target&&source){var onChange=function(change){(!filter||filter(target,source,change))&&applyChange(target,source,change)};deepDiff(target,source,onChange)}}var $scope,conflict,conflictResolution=[];$scope="object"==typeof global&&global?global:"undefined"!=typeof window?window:{},conflict=$scope.DeepDiff,conflict&&conflictResolution.push(function(){"undefined"!=typeof conflict&&$scope.DeepDiff===accumulateDiff&&($scope.DeepDiff=conflict,conflict=undefined)}),inherits(DiffEdit,Diff),inherits(DiffNew,Diff),inherits(DiffDeleted,Diff),inherits(DiffArray,Diff),Object.defineProperties(accumulateDiff,{diff:{value:accumulateDiff,enumerable:!0},observableDiff:{value:deepDiff,enumerable:!0},applyDiff:{value:applyDiff,enumerable:!0},applyChange:{value:applyChange,enumerable:!0},revertChange:{value:revertChange,enumerable:!0},isConflict:{get:function(){return"undefined"!=typeof conflict},enumerable:!0},noConflict:{value:function(){return conflictResolution&&(conflictResolution.forEach(function(it){it()}),conflictResolution=null),accumulateDiff},enumerable:!0}}),"undefined"!=typeof module&&module&&"object"==typeof exports&&exports&&module.exports===exports?module.exports=accumulateDiff:$scope.DeepDiff=accumulateDiff}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],50:[function(_hreq__,module){"use strict";function Delver(obj){return this._object=obj,this}function getSubkey(parts,pos){return parts.slice(0,pos).join(".")}function Accessor(obj,key){this._object=obj,this._key=key}function delve(options){if("object"!=typeof options.object)throw new TypeError("Object to access must be an object.");if("string"!=typeof options.key)throw new TypeError("Key to access must be a string.");for(var obj=options.object,parts=options.key.split("."),i=0;i<parts.length;++i){var isKey=i==parts.length-1,part=parts[i];if("string"!=typeof part||0===part.length)throw new Error("Key is invalid: "+options.key);var exists=options.strict?obj.hasOwnProperty(part):"undefined"!=typeof obj[part];if(/\[/.test(part)){var found=part.match(arraymatcher);if(3!=found.length)throw new Error("Subkey '"+getSubkey(parts,i)+"' is not a valid array accessor. ("+options.key+")");var name=found[1],index=found[2];if(0===name.length)throw new Error("Subkey '"+getSubkey(parts,i)+"' is not a valid key, it must have a name in addition to an array subscript. ("+options.key+")");if(exists=options.strict?obj.hasOwnProperty(name):"undefined"!=typeof obj[name],void 0===index){if(options.read)throw new Error("Subkey '"+getSubkey(parts,i)+"' is not a valid key, it must have a valid array index when reading. ("+options.key+")");index=exists&&isArray(obj[name])?obj[name].length:0}else index=parseInt(index);if(exists){if(!isArray(obj[name]))throw new Error("Subkey '"+getSubkey(parts,i)+"' is not valid because '"+name+"' is not an array. ("+options.key+")");if(index>obj[name].length-1){if(!options.create){if(options.read)return void 0;throw new Error("Subkey '"+getSubkey(parts,i)+"' is not valid because index '"+index+"' is out of bounds and create is not enabled. ("+options.key+")")}var sizeNeeded=index-obj[name].length+1;if(1==sizeNeeded?obj[name].push(isKey?options.value:null):obj[name]=obj[name].concat(new Array(sizeNeeded)),isKey)return new Accessor(obj[name],index);obj=obj[name][index]={}}else{if(isKey)return new Accessor(obj[name],index);obj=obj[name][index]}}else{if(!options.create){if(options.read)return void 0;throw new Error("Subkey '"+getSubkey(parts,i)+"' is not valid because it does not exist and create is not enabled. ("+options.key+")")}if(obj[name]=new Array(index+1),isKey)return new Accessor(obj[name],index);obj=obj[name][index]={}}}else{if("object"!=typeof obj)throw new Error("Part '"+getSubkey(parts,i)+".' of the given key is not an object.");if(isArray(obj))throw new Error("Part '"+getSubkey(parts,i)+".' of the given key is an array, but has no index accessor ([]).");if(exists){if(isKey)return new Accessor(obj,part);obj=obj[part]}else{if(isKey)return options.read?void 0:new Accessor(obj,part);if(options.read)return void 0;if(!options.create)throw new Error("Subkey '"+getSubkey(parts,i)+"' is not valid because it does not exist and create is not enabled. ("+options.key+")");obj=obj[part]={}}}}throw Error("Failed to resolve: "+options.key)}module.exports=Delver,Delver.prototype.get=function(key,_default){return key?Delver.get(this._object,key,_default):this._object},Delver.prototype.set=function(key,value){return Delver.set(this._object,key,value)};var isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},arraymatcher=/^(.*?)\[(\d+)?\]$/;Accessor.prototype.get=function(){return this._object[this._key]},Accessor.prototype.set=function(value){return this._object[this._key]=value},Delver.get=function(obj,key,_default){var strict=!0;"undefined"==typeof key&&(key=obj.key,strict="undefined"!=typeof obj.strict?obj.strict:strict,_default=obj._default,obj=obj.object);var accessor=delve({read:!0,strict:strict,object:obj,key:key});return void 0===accessor?_default:accessor.get()},Delver.set=function(obj,key,val,create){var strict=!0,_constructor=null;"undefined"==typeof key&&(key=obj.key,val=obj.value,create=obj.create,strict="undefined"!=typeof obj.strict?obj.strict:strict,_constructor=obj._constructor,obj=obj.object);var accessor=delve({strict:strict,create:"undefined"!=typeof create?create:!0,object:obj,key:key,value:val});return accessor.set(_constructor?_constructor(val):val)}},{}],51:[function(_hreq__,module,exports){!function(){function init(){this._events={},this._conf&&configure.call(this,this._conf)}function configure(conf){conf&&(this._conf=conf,conf.delimiter&&(this.delimiter=conf.delimiter),conf.maxListeners&&(this._events.maxListeners=conf.maxListeners),conf.wildcard&&(this.wildcard=conf.wildcard),conf.newListener&&(this.newListener=conf.newListener),this.wildcard&&(this.listenerTree={}))}function EventEmitter(conf){this._events={},this.newListener=!1,configure.call(this,conf)}function searchListenerTree(handlers,type,tree,i){if(!tree)return[];var leaf,len,branch,xTree,xxTree,isolatedBranch,endReached,listeners=[],typeLength=type.length,currentType=type[i],nextType=type[i+1];if(i===typeLength&&tree._listeners){if("function"==typeof tree._listeners)return handlers&&handlers.push(tree._listeners),[tree];for(leaf=0,len=tree._listeners.length;len>leaf;leaf++)handlers&&handlers.push(tree._listeners[leaf]);return[tree]}if("*"===currentType||"**"===currentType||tree[currentType]){if("*"===currentType){for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i+1)));return listeners}if("**"===currentType){endReached=i+1===typeLength||i+2===typeLength&&"*"===nextType,endReached&&tree._listeners&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree,typeLength)));for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&("*"===branch||"**"===branch?(tree[branch]._listeners&&!endReached&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],typeLength))),listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i))):listeners=listeners.concat(branch===nextType?searchListenerTree(handlers,type,tree[branch],i+2):searchListenerTree(handlers,type,tree[branch],i)));return listeners}listeners=listeners.concat(searchListenerTree(handlers,type,tree[currentType],i+1))}if(xTree=tree["*"],xTree&&searchListenerTree(handlers,type,xTree,i+1),xxTree=tree["**"])if(typeLength>i){xxTree._listeners&&searchListenerTree(handlers,type,xxTree,typeLength);for(branch in xxTree)"_listeners"!==branch&&xxTree.hasOwnProperty(branch)&&(branch===nextType?searchListenerTree(handlers,type,xxTree[branch],i+2):branch===currentType?searchListenerTree(handlers,type,xxTree[branch],i+1):(isolatedBranch={},isolatedBranch[branch]=xxTree[branch],searchListenerTree(handlers,type,{"**":isolatedBranch},i+1)))}else xxTree._listeners?searchListenerTree(handlers,type,xxTree,typeLength):xxTree["*"]&&xxTree["*"]._listeners&&searchListenerTree(handlers,type,xxTree["*"],typeLength);return listeners}function growListenerTree(type,listener){type="string"==typeof type?type.split(this.delimiter):type.slice();for(var i=0,len=type.length;len>i+1;i++)if("**"===type[i]&&"**"===type[i+1])return;for(var tree=this.listenerTree,name=type.shift();name;){if(tree[name]||(tree[name]={}),tree=tree[name],0===type.length){if(tree._listeners){if("function"==typeof tree._listeners)tree._listeners=[tree._listeners,listener];else if(isArray(tree._listeners)&&(tree._listeners.push(listener),!tree._listeners.warned)){var m=defaultMaxListeners;"undefined"!=typeof this._events.maxListeners&&(m=this._events.maxListeners),m>0&&tree._listeners.length>m&&(tree._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",tree._listeners.length),console.trace())}}else tree._listeners=listener;return!0}name=type.shift()}return!0}var isArray=Array.isArray?Array.isArray:function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},defaultMaxListeners=10;EventEmitter.prototype.delimiter=".",EventEmitter.prototype.setMaxListeners=function(n){this._events||init.call(this),this._events.maxListeners=n,this._conf||(this._conf={}),this._conf.maxListeners=n},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(event,fn){return this.many(event,1,fn),this},EventEmitter.prototype.many=function(event,ttl,fn){function listener(){0===--ttl&&self.off(event,listener),fn.apply(this,arguments)}var self=this;if("function"!=typeof fn)throw new Error("many only accepts instances of Function");return listener._origin=fn,this.on(event,listener),self},EventEmitter.prototype.emit=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var l=arguments.length,args=new Array(l-1),i=1;l>i;i++)args[i-1]=arguments[i];for(i=0,l=this._all.length;l>i;i++)this.event=type,this._all[i].apply(this,args)}if("error"===type&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var handler;if(this.wildcard){handler=[];var ns="string"==typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else handler=this._events[type];if("function"==typeof handler){if(this.event=type,1===arguments.length)handler.call(this);else if(arguments.length>1)switch(arguments.length){case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(var l=arguments.length,args=new Array(l-1),i=1;l>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}return!0}if(handler){for(var l=arguments.length,args=new Array(l-1),i=1;l>i;i++)args[i-1]=arguments[i];for(var listeners=handler.slice(),i=0,l=listeners.length;l>i;i++)this.event=type,listeners[i].apply(this,args);return listeners.length>0||!!this._all}return!!this._all},EventEmitter.prototype.on=function(type,listener){if("function"==typeof type)return this.onAny(type),this;if("function"!=typeof listener)throw new Error("on only accepts instances of Function");if(this._events||init.call(this),this.emit("newListener",type,listener),this.wildcard)return growListenerTree.call(this,type,listener),this;if(this._events[type]){if("function"==typeof this._events[type])this._events[type]=[this._events[type],listener];else if(isArray(this._events[type])&&(this._events[type].push(listener),!this._events[type].warned)){var m=defaultMaxListeners;"undefined"!=typeof this._events.maxListeners&&(m=this._events.maxListeners),m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),console.trace())}}else this._events[type]=listener;return this},EventEmitter.prototype.onAny=function(fn){if("function"!=typeof fn)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(fn),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(type,listener){if("function"!=typeof listener)throw new Error("removeListener only takes instances of Function");var handlers,leafs=[];if(this.wildcard){var ns="string"==typeof type?type.split(this.delimiter):type.slice();leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)}else{if(!this._events[type])return this;handlers=this._events[type],leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];if(handlers=leaf._listeners,isArray(handlers)){for(var position=-1,i=0,length=handlers.length;length>i;i++)if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}if(0>position)continue;return this.wildcard?leaf._listeners.splice(position,1):this._events[type].splice(position,1),0===handlers.length&&(this.wildcard?delete leaf._listeners:delete this._events[type]),this}(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener)&&(this.wildcard?delete leaf._listeners:delete this._events[type])
}return this},EventEmitter.prototype.offAny=function(fn){var fns,i=0,l=0;if(fn&&this._all&&this._all.length>0){for(fns=this._all,i=0,l=fns.length;l>i;i++)if(fn===fns[i])return fns.splice(i,1),this}else this._all=[];return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(type){if(0===arguments.length)return!this._events||init.call(this),this;if(this.wildcard)for(var ns="string"==typeof type?type.split(this.delimiter):type.slice(),leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0),iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];leaf._listeners=null}else{if(!this._events[type])return this;this._events[type]=null}return this},EventEmitter.prototype.listeners=function(type){if(this.wildcard){var handlers=[],ns="string"==typeof type?type.split(this.delimiter):type.slice();return searchListenerTree.call(this,handlers,ns,this.listenerTree,0),handlers}return this._events||init.call(this),this._events[type]||(this._events[type]=[]),isArray(this._events[type])||(this._events[type]=[this._events[type]]),this._events[type]},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return EventEmitter}):"object"==typeof exports?exports.EventEmitter2=EventEmitter:window.EventEmitter2=EventEmitter}()},{}],52:[function(_hreq__,module){var undefined,hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,isPlainObject=function(obj){"use strict";if(!obj||"[object Object]"!==toString.call(obj))return!1;var has_own_constructor=hasOwn.call(obj,"constructor"),has_is_property_of_method=obj.constructor&&obj.constructor.prototype&&hasOwn.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!has_own_constructor&&!has_is_property_of_method)return!1;var key;for(key in obj);return key===undefined||hasOwn.call(obj,key)};module.exports=function extend(){"use strict";var options,name,src,copy,copyIsArray,clone,target=arguments[0],i=1,length=arguments.length,deep=!1;for("boolean"==typeof target?(deep=target,target=arguments[1]||{},i=2):("object"!=typeof target&&"function"!=typeof target||null==target)&&(target={});length>i;++i)if(options=arguments[i],null!=options)for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&Array.isArray(src)?src:[]):clone=src&&isPlainObject(src)?src:{},target[name]=extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy));return target}},{}],53:[function(_hreq__,module){"use strict";function getSignatureData(callback){var signatureData={};antisync.parallel([getRandomID.bind(null,signatureData),getBrowserSignature.bind(null,signatureData),getCanvasSignature.bind(null,signatureData)],function(error){callback(error,signatureData)})}function getRandomID(signatureData,callback){signatureData.random={signature:uuid.v4()},callback()}function getBrowserSignature(signatureData,callback){var idString=navigator.userAgent+navigator.language;for(var key in navigator.plugins){var plugin=navigator.plugins[key];idString+=plugin.name+plugin.filename+plugin.description}signatureData.browser={signature:SHA256(idString)},callback()}function getCanvasSignature(signatureData,callback){signatureData.canvas={signature:null};var canvas=document.createElement("canvas");if(!canvas||!canvas.getContext)return void callback();var width=CANVAS_FONT_SIZE*(CANVAS_TEXT.length+2),height=2*CANVAS_FONT_SIZE;canvas.setAttribute("width",width),canvas.setAttribute("height",height);var ctx=canvas.getContext("2d");if(!ctx||"function"!=typeof ctx.fillText)return void callback();ctx.font=CANVAS_FONT_SIZE+"px '"+CANVAS_FONT_FACE+"'",ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillStyle="#f60",ctx.fillRect(3*width/8,0,width/4,height),ctx.fillStyle="#069",ctx.fillText(CANVAS_TEXT,width/2,height/2),ctx.fillStyle="rgba(102, 204, 0, 0.7)",ctx.fillText(CANVAS_TEXT,width/2+2,height/2+2);var base64png=canvas.toDataURL("image/png");signatureData.canvas.signature=SHA256(base64png),callback()}function SHA256(data){function safe_add(x,y){var lsw=(65535&x)+(65535&y),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|65535&lsw}function s(X,n){return X>>>n|X<<32-n}function r(X,n){return X>>>n}function ch(x,y,z){return x&y^~x&z}function maj(x,y,z){return x&y^x&z^y&z}function sigma0256(x){return s(x,2)^s(x,13)^s(x,22)}function sigma1256(x){return s(x,6)^s(x,11)^s(x,25)}function gamma0256(x){return s(x,7)^s(x,18)^r(x,3)}function gamma1256(x){return s(x,17)^s(x,19)^r(x,10)}function core_sha256(m,l){var a,b,c,d,e,f,g,h,i,j,T1,T2,K=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),HASH=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),W=new Array(64);for(m[l>>5]|=128<<24-l%32,m[(l+64>>9<<4)+15]=l,i=0;i<m.length;i+=16){for(a=HASH[0],b=HASH[1],c=HASH[2],d=HASH[3],e=HASH[4],f=HASH[5],g=HASH[6],h=HASH[7],j=0;64>j;j++)W[j]=16>j?m[j+i]:safe_add(safe_add(safe_add(gamma1256(W[j-2]),W[j-7]),gamma0256(W[j-15])),W[j-16]),T1=safe_add(safe_add(safe_add(safe_add(h,sigma1256(e)),ch(e,f,g)),K[j]),W[j]),T2=safe_add(sigma0256(a),maj(a,b,c)),h=g,g=f,f=e,e=safe_add(d,T1),d=c,c=b,b=a,a=safe_add(T1,T2);HASH[0]=safe_add(a,HASH[0]),HASH[1]=safe_add(b,HASH[1]),HASH[2]=safe_add(c,HASH[2]),HASH[3]=safe_add(d,HASH[3]),HASH[4]=safe_add(e,HASH[4]),HASH[5]=safe_add(f,HASH[5]),HASH[6]=safe_add(g,HASH[6]),HASH[7]=safe_add(h,HASH[7])}return HASH}function str2binb(str){for(var bin=[],mask=(1<<chrsz)-1,i=0;i<str.length*chrsz;i+=chrsz)bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<24-i%32;return bin}function utf8Encode(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);128>c?utftext+=String.fromCharCode(c):c>127&&2048>c?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext}function binb2hex(binarray){for(var str="",i=0;i<4*binarray.length;i++)str+=HEX_TAB.charAt(binarray[i>>2]>>8*(3-i%4)+4&15)+HEX_TAB.charAt(binarray[i>>2]>>8*(3-i%4)&15);return str}var chrsz=8,utf=utf8Encode(data);return binb2hex(core_sha256(str2binb(utf),utf.length*chrsz))}var antisync={parallel:_hreq__(59)},uuid=_hreq__(70),localforage=_hreq__(67);module.exports={};var STORAGE_KEY="ubid:signaturedata";module.exports.get=function(callback){function onFound(signatureJSON){function handleSignatureData(error,signatureData){error||localforage.setItem(STORAGE_KEY,JSON.stringify(signatureData)),signatureData&&(signatureData.localStorage=!0),callback(error,signatureData)}if(!storedIDChecked){if(storedIDChecked=!0,!signatureJSON)return void getSignatureData(handleSignatureData);try{var signatureData=JSON.parse(signatureJSON);signatureData.localStorage=!0,callback(null,signatureData)}catch(ex){getSignatureData(handleSignatureData)}}}function onError(){storedIDChecked||(storedIDChecked=!0,getSignatureData(callback))}var storedIDChecked=!1;localforage.getItem(STORAGE_KEY).then(onFound,onError).catch(onError),setTimeout(onError,300)};var CANVAS_TEXT="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz 1234567890 !@#$%^&*()_-+=",CANVAS_FONT_SIZE=16,CANVAS_FONT_FACE="Arial",HEX_TAB="0123456789abcdef"},{59:59,67:67,70:70}],54:[function(_hreq__,module){module.exports=_hreq__(3)},{3:3,55:55,56:56,60:60}],55:[function(_hreq__,module){module.exports=_hreq__(4)},{4:4,60:60}],56:[function(_hreq__,module){module.exports=_hreq__(5)},{5:5}],57:[function(_hreq__,module){module.exports=_hreq__(6)},{54:54,58:58,6:6}],58:[function(_hreq__,module){module.exports=_hreq__(7)},{60:60,7:7}],59:[function(_hreq__,module){module.exports=_hreq__(9)},{54:54,55:55,57:57,9:9}],60:[function(_hreq__,module){module.exports=_hreq__(12)},{12:12}],61:[function(_hreq__,module){"use strict";function Promise(fn){function handle(deferred){return null===state?void deferreds.push(deferred):void asap(function(){var cb=state?deferred.onFulfilled:deferred.onRejected;if(null===cb)return void(state?deferred.resolve:deferred.reject)(value);var ret;try{ret=cb(value)}catch(e){return void deferred.reject(e)}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if("function"==typeof then)return void doResolve(then.bind(newValue),resolve,reject)}state=!0,value=newValue,finale()}catch(e){reject(e)}}function reject(newValue){state=!1,value=newValue,finale()}function finale(){for(var i=0,len=deferreds.length;len>i;i++)handle(deferreds[i]);deferreds=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");var state=null,value=null,deferreds=[],self=this;this.then=function(onFulfilled,onRejected){return new Promise(function(resolve,reject){handle(new Handler(onFulfilled,onRejected,resolve,reject))})},doResolve(fn,resolve,reject)}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.resolve=resolve,this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){done||(done=!0,onFulfilled(value))},function(reason){done||(done=!0,onRejected(reason))})}catch(ex){if(done)return;done=!0,onRejected(ex)}}var asap=_hreq__(63);module.exports=Promise},{63:63}],62:[function(_hreq__,module){"use strict";function ValuePromise(value){this.then=function(onFulfilled){return"function"!=typeof onFulfilled?this:new Promise(function(resolve,reject){asap(function(){try{resolve(onFulfilled(value))}catch(ex){reject(ex)}})})}}var Promise=_hreq__(61),asap=_hreq__(63);module.exports=Promise,ValuePromise.prototype=Object.create(Promise.prototype);var TRUE=new ValuePromise(!0),FALSE=new ValuePromise(!1),NULL=new ValuePromise(null),UNDEFINED=new ValuePromise(void 0),ZERO=new ValuePromise(0),EMPTYSTRING=new ValuePromise("");Promise.resolve=function(value){if(value instanceof Promise)return value;if(null===value)return NULL;if(void 0===value)return UNDEFINED;if(value===!0)return TRUE;if(value===!1)return FALSE;if(0===value)return ZERO;if(""===value)return EMPTYSTRING;if("object"==typeof value||"function"==typeof value)try{var then=value.then;if("function"==typeof then)return new Promise(then.bind(value))}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}return new ValuePromise(value)},Promise.from=Promise.cast=function(value){var err=new Error("Promise.from and Promise.cast are deprecated, use Promise.resolve instead");return err.name="Warning",console.warn(err.stack),Promise.resolve(value)},Promise.denodeify=function(fn,argumentCount){return argumentCount=argumentCount||1/0,function(){var self=this,args=Array.prototype.slice.call(arguments);return new Promise(function(resolve,reject){for(;args.length&&args.length>argumentCount;)args.pop();args.push(function(err,res){err?reject(err):resolve(res)}),fn.apply(self,args)})}},Promise.nodeify=function(fn){return function(){var args=Array.prototype.slice.call(arguments),callback="function"==typeof args[args.length-1]?args.pop():null;try{return fn.apply(this,arguments).nodeify(callback)}catch(ex){if(null===callback||"undefined"==typeof callback)return new Promise(function(resolve,reject){reject(ex)});asap(function(){callback(ex)})}}},Promise.all=function(){var calledWithArray=1===arguments.length&&Array.isArray(arguments[0]),args=Array.prototype.slice.call(calledWithArray?arguments[0]:arguments);if(!calledWithArray){var err=new Error("Promise.all should be called with a single array, calling it with multiple arguments is deprecated");err.name="Warning",console.warn(err.stack)}return new Promise(function(resolve,reject){function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0===--remaining&&resolve(args)}catch(ex){reject(ex)}}if(0===args.length)return resolve([]);for(var remaining=args.length,i=0;i<args.length;i++)res(i,args[i])})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})},Promise.prototype.done=function(){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){asap(function(){throw err})})},Promise.prototype.nodeify=function(callback){return"function"!=typeof callback?this:void this.then(function(value){asap(function(){callback(null,value)})},function(err){asap(function(){callback(err)})})},Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)}},{61:61,63:63}],63:[function(_hreq__,module){(function(process){function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;domain&&(head.domain=void 0,domain.enter());try{task()}catch(e){if(isNodeJS)throw domain&&domain.exit(),setTimeout(flush,0),domain&&domain.enter(),e;setTimeout(function(){throw e},0)}domain&&domain.exit()}flushing=!1}function asap(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null},flushing||(flushing=!0,requestFlush())}var head={task:void 0,next:null},tail=head,flushing=!1,requestFlush=void 0,isNodeJS=!1;if("undefined"!=typeof process&&process.nextTick)isNodeJS=!0,requestFlush=function(){process.nextTick(flush)};else if("function"==typeof setImmediate)requestFlush="undefined"!=typeof window?setImmediate.bind(window,flush):function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=flush,requestFlush=function(){channel.port2.postMessage(0)}}else requestFlush=function(){setTimeout(flush,0)};module.exports=asap}).call(this,_hreq__(26))},{26:26}],64:[function(_hreq__,module){(function(){"use strict";function _initStorage(options){var self=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]=options[i];return new Promise(function(resolve,reject){var openreq=indexedDB.open(dbInfo.name,dbInfo.version);openreq.onerror=function(){reject(openreq.error)},openreq.onupgradeneeded=function(){openreq.result.createObjectStore(dbInfo.storeName)},openreq.onsuccess=function(){dbInfo.db=openreq.result,self._dbInfo=dbInfo,resolve()}})}function getItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.get(key);req.onsuccess=function(){var value=req.result;void 0===value&&(value=null),resolve(value)},req.onerror=function(){reject(req.error)}}).catch(reject)});return executeDeferedCallback(promise,callback),promise}function iterate(iterator,callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.openCursor(),iterationNumber=1;req.onsuccess=function(){var cursor=req.result;if(cursor){var result=iterator(cursor.value,cursor.key,iterationNumber++);void 0!==result?resolve(result):cursor.continue()}else resolve()},req.onerror=function(){reject(req.error)}}).catch(reject)});return executeDeferedCallback(promise,callback),promise}function setItem(key,value,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite"),store=transaction.objectStore(dbInfo.storeName);null===value&&(value=void 0);var req=store.put(value,key);transaction.oncomplete=function(){void 0===value&&(value=null),resolve(value)},transaction.onabort=transaction.onerror=function(){reject(req.error)}}).catch(reject)});return executeDeferedCallback(promise,callback),promise}function removeItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite"),store=transaction.objectStore(dbInfo.storeName),req=store.delete(key);transaction.oncomplete=function(){resolve()},transaction.onerror=function(){reject(req.error)},transaction.onabort=function(event){var error=event.target.error;"QuotaExceededError"===error&&reject(error)}}).catch(reject)});return executeDeferedCallback(promise,callback),promise}function clear(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite"),store=transaction.objectStore(dbInfo.storeName),req=store.clear();transaction.oncomplete=function(){resolve()},transaction.onabort=transaction.onerror=function(){reject(req.error)}}).catch(reject)});return executeDeferedCallback(promise,callback),promise}function length(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.count();req.onsuccess=function(){resolve(req.result)},req.onerror=function(){reject(req.error)}}).catch(reject)});return executeCallback(promise,callback),promise}function key(n,callback){var self=this,promise=new Promise(function(resolve,reject){return 0>n?void resolve(null):void self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),advanced=!1,req=store.openCursor();req.onsuccess=function(){var cursor=req.result;return cursor?void(0===n?resolve(cursor.key):advanced?resolve(cursor.key):(advanced=!0,cursor.advance(n))):void resolve(null)},req.onerror=function(){reject(req.error)}}).catch(reject)});return executeCallback(promise,callback),promise}function keys(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.openCursor(),keys=[];req.onsuccess=function(){var cursor=req.result;return cursor?(keys.push(cursor.key),void cursor.continue()):void resolve(keys)},req.onerror=function(){reject(req.error)}}).catch(reject)});return executeCallback(promise,callback),promise}function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}function executeDeferedCallback(promise,callback){callback&&promise.then(function(result){deferCallback(callback,result)},function(error){callback(error)})}function deferCallback(callback,result){return callback?setTimeout(function(){return callback(null,result)},0):void 0}var Promise="undefined"!=typeof module&&module.exports?_hreq__(62):this.Promise,indexedDB=indexedDB||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(indexedDB){var asyncStorage={_driver:"asyncStorage",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};"undefined"!=typeof module&&module.exports?module.exports=asyncStorage:"function"==typeof define&&define.amd?define("asyncStorage",function(){return asyncStorage}):this.asyncStorage=asyncStorage}}).call(window)},{62:62}],65:[function(_hreq__,module){(function(){"use strict";function _initStorage(options){var self=this,dbInfo={};if(options)for(var i in options)dbInfo[i]=options[i];dbInfo.keyPrefix=dbInfo.name+"/",self._dbInfo=dbInfo;var serializerPromise=new Promise(function(resolve){moduleType===ModuleType.DEFINE?_hreq__(["localforageSerializer"],resolve):resolve(moduleType===ModuleType.EXPORT?_hreq__(68):globalObject.localforageSerializer)});return serializerPromise.then(function(lib){return serializer=lib,Promise.resolve()})}function clear(callback){var self=this,promise=self.ready().then(function(){for(var keyPrefix=self._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var key=localStorage.key(i);0===key.indexOf(keyPrefix)&&localStorage.removeItem(key)}});return executeCallback(promise,callback),promise}function getItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){var dbInfo=self._dbInfo,result=localStorage.getItem(dbInfo.keyPrefix+key);return result&&(result=serializer.deserialize(result)),result});return executeCallback(promise,callback),promise}function iterate(iterator,callback){var self=this,promise=self.ready().then(function(){for(var keyPrefix=self._dbInfo.keyPrefix,keyPrefixLength=keyPrefix.length,length=localStorage.length,i=0;length>i;i++){var key=localStorage.key(i),value=localStorage.getItem(key);if(value&&(value=serializer.deserialize(value)),value=iterator(value,key.substring(keyPrefixLength),i+1),void 0!==value)return value}});return executeCallback(promise,callback),promise}function key(n,callback){var self=this,promise=self.ready().then(function(){var result,dbInfo=self._dbInfo;try{result=localStorage.key(n)}catch(error){result=null}return result&&(result=result.substring(dbInfo.keyPrefix.length)),result});return executeCallback(promise,callback),promise}function keys(callback){var self=this,promise=self.ready().then(function(){for(var dbInfo=self._dbInfo,length=localStorage.length,keys=[],i=0;length>i;i++)0===localStorage.key(i).indexOf(dbInfo.keyPrefix)&&keys.push(localStorage.key(i).substring(dbInfo.keyPrefix.length));return keys});return executeCallback(promise,callback),promise}function length(callback){var self=this,promise=self.keys().then(function(keys){return keys.length});return executeCallback(promise,callback),promise}function removeItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){var dbInfo=self._dbInfo;localStorage.removeItem(dbInfo.keyPrefix+key)});return executeCallback(promise,callback),promise}function setItem(key,value,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){void 0===value&&(value=null);var originalValue=value;return new Promise(function(resolve,reject){serializer.serialize(value,function(value,error){if(error)reject(error);else try{var dbInfo=self._dbInfo;localStorage.setItem(dbInfo.keyPrefix+key,value),resolve(originalValue)}catch(e){("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&reject(e),reject(e)}})})});return executeCallback(promise,callback),promise}function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}var Promise="undefined"!=typeof module&&module.exports?_hreq__(62):this.Promise,globalObject=this,serializer=null,localStorage=null;try{if(!(this.localStorage&&"setItem"in this.localStorage))return;localStorage=this.localStorage}catch(e){return}var ModuleType={DEFINE:1,EXPORT:2,WINDOW:3},moduleType=ModuleType.WINDOW;"undefined"!=typeof module&&module.exports?moduleType=ModuleType.EXPORT:"function"==typeof define&&define.amd&&(moduleType=ModuleType.DEFINE);var localStorageWrapper={_driver:"localStorageWrapper",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};moduleType===ModuleType.EXPORT?module.exports=localStorageWrapper:moduleType===ModuleType.DEFINE?define("localStorageWrapper",function(){return localStorageWrapper}):this.localStorageWrapper=localStorageWrapper}).call(window)},{62:62,68:68}],66:[function(_hreq__,module){(function(){"use strict";function _initStorage(options){var self=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]="string"!=typeof options[i]?options[i].toString():options[i];var serializerPromise=new Promise(function(resolve){moduleType===ModuleType.DEFINE?_hreq__(["localforageSerializer"],resolve):resolve(moduleType===ModuleType.EXPORT?_hreq__(68):globalObject.localforageSerializer)}),dbInfoPromise=new Promise(function(resolve,reject){try{dbInfo.db=openDatabase(dbInfo.name,String(dbInfo.version),dbInfo.description,dbInfo.size)}catch(e){return self.setDriver(self.LOCALSTORAGE).then(function(){return self._initStorage(options)}).then(resolve).catch(reject)}dbInfo.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+dbInfo.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){self._dbInfo=dbInfo,resolve()},function(t,error){reject(error)})})});return serializerPromise.then(function(lib){return serializer=lib,dbInfoPromise})}function getItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName+" WHERE key = ? LIMIT 1",[key],function(t,results){var result=results.rows.length?results.rows.item(0).value:null;result&&(result=serializer.deserialize(result)),resolve(result)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function iterate(iterator,callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName,[],function(t,results){for(var rows=results.rows,length=rows.length,i=0;length>i;i++){var item=rows.item(i),result=item.value;if(result&&(result=serializer.deserialize(result)),result=iterator(result,item.key,i+1),void 0!==result)return void resolve(result)}resolve()},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function setItem(key,value,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){void 0===value&&(value=null);var originalValue=value;serializer.serialize(value,function(value,error){if(error)reject(error);else{var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+dbInfo.storeName+" (key, value) VALUES (?, ?)",[key,value],function(){resolve(originalValue)},function(t,error){reject(error)})},function(sqlError){sqlError.code===sqlError.QUOTA_ERR&&reject(sqlError)})}})}).catch(reject)});return executeCallback(promise,callback),promise}function removeItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName+" WHERE key = ?",[key],function(){resolve()},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function clear(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName,[],function(){resolve()},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function length(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+dbInfo.storeName,[],function(t,results){var result=results.rows.item(0).c;resolve(result)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function key(n,callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName+" WHERE id = ? LIMIT 1",[n+1],function(t,results){var result=results.rows.length?results.rows.item(0).key:null;resolve(result)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function keys(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName,[],function(t,results){for(var keys=[],i=0;i<results.rows.length;i++)keys.push(results.rows.item(i).key);resolve(keys)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}var Promise="undefined"!=typeof module&&module.exports?_hreq__(62):this.Promise,globalObject=this,serializer=null,openDatabase=this.openDatabase;if(openDatabase){var ModuleType={DEFINE:1,EXPORT:2,WINDOW:3},moduleType=ModuleType.WINDOW;"undefined"!=typeof module&&module.exports?moduleType=ModuleType.EXPORT:"function"==typeof define&&define.amd&&(moduleType=ModuleType.DEFINE);var webSQLStorage={_driver:"webSQLStorage",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};moduleType===ModuleType.DEFINE?define("webSQLStorage",function(){return webSQLStorage}):moduleType===ModuleType.EXPORT?module.exports=webSQLStorage:this.webSQLStorage=webSQLStorage}}).call(window)},{62:62,68:68}],67:[function(_hreq__,module){(function(){"use strict";function callWhenReady(localForageInstance,libraryMethod){localForageInstance[libraryMethod]=function(){var _args=arguments;return localForageInstance.ready().then(function(){return localForageInstance[libraryMethod].apply(localForageInstance,_args)})}}function extend(){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(arg)for(var key in arg)arg.hasOwnProperty(key)&&(arguments[0][key]=isArray(arg[key])?arg[key].slice():arg[key])}return arguments[0]}function isLibraryDriver(driverName){for(var driver in DriverType)if(DriverType.hasOwnProperty(driver)&&DriverType[driver]===driverName)return!0;return!1}function LocalForage(options){this._config=extend({},DefaultConfig,options),this._driverSet=null,this._ready=!1,this._dbInfo=null;for(var i=0;i<LibraryMethods.length;i++)callWhenReady(this,LibraryMethods[i]);
this.setDriver(this._config.driver)}var Promise="undefined"!=typeof module&&module.exports?_hreq__(62):this.Promise,CustomDrivers={},DriverType={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},DefaultDriverOrder=[DriverType.INDEXEDDB,DriverType.WEBSQL,DriverType.LOCALSTORAGE],LibraryMethods=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],ModuleType={DEFINE:1,EXPORT:2,WINDOW:3},DefaultConfig={description:"",driver:DefaultDriverOrder.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},moduleType=ModuleType.WINDOW;"undefined"!=typeof module&&module.exports?moduleType=ModuleType.EXPORT:"function"==typeof define&&define.amd&&(moduleType=ModuleType.DEFINE);var driverSupport=function(self){var indexedDB=indexedDB||self.indexedDB||self.webkitIndexedDB||self.mozIndexedDB||self.OIndexedDB||self.msIndexedDB,result={};return result[DriverType.WEBSQL]=!!self.openDatabase,result[DriverType.INDEXEDDB]=!!function(){if("undefined"!=typeof self.openDatabase&&self.navigator&&self.navigator.userAgent&&/Safari/.test(self.navigator.userAgent)&&!/Chrome/.test(self.navigator.userAgent))return!1;try{return indexedDB&&"function"==typeof indexedDB.open&&"undefined"!=typeof self.IDBKeyRange}catch(e){return!1}}(),result[DriverType.LOCALSTORAGE]=!!function(){try{return self.localStorage&&"setItem"in self.localStorage&&self.localStorage.setItem}catch(e){return!1}}(),result}(this),isArray=Array.isArray||function(arg){return"[object Array]"===Object.prototype.toString.call(arg)},globalObject=this;LocalForage.prototype.INDEXEDDB=DriverType.INDEXEDDB,LocalForage.prototype.LOCALSTORAGE=DriverType.LOCALSTORAGE,LocalForage.prototype.WEBSQL=DriverType.WEBSQL,LocalForage.prototype.config=function(options){if("object"==typeof options){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var i in options)"storeName"===i&&(options[i]=options[i].replace(/\W/g,"_")),this._config[i]=options[i];return"driver"in options&&options.driver&&this.setDriver(this._config.driver),!0}return"string"==typeof options?this._config[options]:this._config},LocalForage.prototype.defineDriver=function(driverObject,callback,errorCallback){var defineDriver=new Promise(function(resolve,reject){try{var driverName=driverObject._driver,complianceError=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),namingError=new Error("Custom driver name already in use: "+driverObject._driver);if(!driverObject._driver)return void reject(complianceError);if(isLibraryDriver(driverObject._driver))return void reject(namingError);for(var customDriverMethods=LibraryMethods.concat("_initStorage"),i=0;i<customDriverMethods.length;i++){var customDriverMethod=customDriverMethods[i];if(!customDriverMethod||!driverObject[customDriverMethod]||"function"!=typeof driverObject[customDriverMethod])return void reject(complianceError)}var supportPromise=Promise.resolve(!0);"_support"in driverObject&&(supportPromise=driverObject._support&&"function"==typeof driverObject._support?driverObject._support():Promise.resolve(!!driverObject._support)),supportPromise.then(function(supportResult){driverSupport[driverName]=supportResult,CustomDrivers[driverName]=driverObject,resolve()},reject)}catch(e){reject(e)}});return defineDriver.then(callback,errorCallback),defineDriver},LocalForage.prototype.driver=function(){return this._driver||null},LocalForage.prototype.ready=function(callback){var self=this,ready=new Promise(function(resolve,reject){self._driverSet.then(function(){null===self._ready&&(self._ready=self._initStorage(self._config)),self._ready.then(resolve,reject)}).catch(reject)});return ready.then(callback,callback),ready},LocalForage.prototype.setDriver=function(drivers,callback,errorCallback){function setDriverToConfig(){self._config.driver=self.driver()}var self=this;return"string"==typeof drivers&&(drivers=[drivers]),this._driverSet=new Promise(function(resolve,reject){var driverName=self._getFirstSupportedDriver(drivers),error=new Error("No available storage method found.");if(!driverName)return self._driverSet=Promise.reject(error),void reject(error);if(self._dbInfo=null,self._ready=null,isLibraryDriver(driverName)){if(moduleType===ModuleType.DEFINE)return void _hreq__([driverName],function(lib){self._extend(lib),resolve()});if(moduleType===ModuleType.EXPORT){var driver;switch(driverName){case self.INDEXEDDB:driver=_hreq__(64);break;case self.LOCALSTORAGE:driver=_hreq__(65);break;case self.WEBSQL:driver=_hreq__(66)}self._extend(driver)}else self._extend(globalObject[driverName])}else{if(!CustomDrivers[driverName])return self._driverSet=Promise.reject(error),void reject(error);self._extend(CustomDrivers[driverName])}resolve()}),this._driverSet.then(setDriverToConfig,setDriverToConfig),this._driverSet.then(callback,errorCallback),this._driverSet},LocalForage.prototype.supports=function(driverName){return!!driverSupport[driverName]},LocalForage.prototype._extend=function(libraryMethodsAndProperties){extend(this,libraryMethodsAndProperties)},LocalForage.prototype._getFirstSupportedDriver=function(drivers){if(drivers&&isArray(drivers))for(var i=0;i<drivers.length;i++){var driver=drivers[i];if(this.supports(driver))return driver}return null},LocalForage.prototype.createInstance=function(options){return new LocalForage(options)};var localForage=new LocalForage;moduleType===ModuleType.DEFINE?define("localforage",function(){return localForage}):moduleType===ModuleType.EXPORT?module.exports=localForage:this.localforage=localForage}).call(window)},{62:62,64:64,65:65,66:66}],68:[function(_hreq__,module){(function(){"use strict";function serialize(value,callback){var valueString="";if(value&&(valueString=value.toString()),value&&("[object ArrayBuffer]"===value.toString()||value.buffer&&"[object ArrayBuffer]"===value.buffer.toString())){var buffer,marker=SERIALIZED_MARKER;value instanceof ArrayBuffer?(buffer=value,marker+=TYPE_ARRAYBUFFER):(buffer=value.buffer,"[object Int8Array]"===valueString?marker+=TYPE_INT8ARRAY:"[object Uint8Array]"===valueString?marker+=TYPE_UINT8ARRAY:"[object Uint8ClampedArray]"===valueString?marker+=TYPE_UINT8CLAMPEDARRAY:"[object Int16Array]"===valueString?marker+=TYPE_INT16ARRAY:"[object Uint16Array]"===valueString?marker+=TYPE_UINT16ARRAY:"[object Int32Array]"===valueString?marker+=TYPE_INT32ARRAY:"[object Uint32Array]"===valueString?marker+=TYPE_UINT32ARRAY:"[object Float32Array]"===valueString?marker+=TYPE_FLOAT32ARRAY:"[object Float64Array]"===valueString?marker+=TYPE_FLOAT64ARRAY:callback(new Error("Failed to get type for BinaryArray"))),callback(marker+bufferToString(buffer))}else if("[object Blob]"===valueString){var fileReader=new FileReader;fileReader.onload=function(){var str=bufferToString(this.result);callback(SERIALIZED_MARKER+TYPE_BLOB+str)},fileReader.readAsArrayBuffer(value)}else try{callback(JSON.stringify(value))}catch(e){window.console.error("Couldn't convert value into a JSON string: ",value),callback(null,e)}}function deserialize(value){if(value.substring(0,SERIALIZED_MARKER_LENGTH)!==SERIALIZED_MARKER)return JSON.parse(value);var serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH),type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH),buffer=stringToBuffer(serializedString);switch(type){case TYPE_ARRAYBUFFER:return buffer;case TYPE_BLOB:return new Blob([buffer]);case TYPE_INT8ARRAY:return new Int8Array(buffer);case TYPE_UINT8ARRAY:return new Uint8Array(buffer);case TYPE_UINT8CLAMPEDARRAY:return new Uint8ClampedArray(buffer);case TYPE_INT16ARRAY:return new Int16Array(buffer);case TYPE_UINT16ARRAY:return new Uint16Array(buffer);case TYPE_INT32ARRAY:return new Int32Array(buffer);case TYPE_UINT32ARRAY:return new Uint32Array(buffer);case TYPE_FLOAT32ARRAY:return new Float32Array(buffer);case TYPE_FLOAT64ARRAY:return new Float64Array(buffer);default:throw new Error("Unkown type: "+type)}}function stringToBuffer(serializedString){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*serializedString.length,len=serializedString.length,p=0;"="===serializedString[serializedString.length-1]&&(bufferLength--,"="===serializedString[serializedString.length-2]&&bufferLength--);var buffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(buffer);for(i=0;len>i;i+=4)encoded1=BASE_CHARS.indexOf(serializedString[i]),encoded2=BASE_CHARS.indexOf(serializedString[i+1]),encoded3=BASE_CHARS.indexOf(serializedString[i+2]),encoded4=BASE_CHARS.indexOf(serializedString[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return buffer}function bufferToString(buffer){var i,bytes=new Uint8Array(buffer),base64String="";for(i=0;i<bytes.length;i+=3)base64String+=BASE_CHARS[bytes[i]>>2],base64String+=BASE_CHARS[(3&bytes[i])<<4|bytes[i+1]>>4],base64String+=BASE_CHARS[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64String+=BASE_CHARS[63&bytes[i+2]];return bytes.length%3===2?base64String=base64String.substring(0,base64String.length-1)+"=":bytes.length%3===1&&(base64String=base64String.substring(0,base64String.length-2)+"=="),base64String}var BASE_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",SERIALIZED_MARKER="__lfsc__:",SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER.length,TYPE_ARRAYBUFFER="arbf",TYPE_BLOB="blob",TYPE_INT8ARRAY="si08",TYPE_UINT8ARRAY="ui08",TYPE_UINT8CLAMPEDARRAY="uic8",TYPE_INT16ARRAY="si16",TYPE_INT32ARRAY="si32",TYPE_UINT16ARRAY="ur16",TYPE_UINT32ARRAY="ui32",TYPE_FLOAT32ARRAY="fl32",TYPE_FLOAT64ARRAY="fl64",TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+TYPE_ARRAYBUFFER.length,localforageSerializer={serialize:serialize,deserialize:deserialize,stringToBuffer:stringToBuffer,bufferToString:bufferToString};"undefined"!=typeof module&&module.exports?module.exports=localforageSerializer:"function"==typeof define&&define.amd?define("localforageSerializer",function(){return localforageSerializer}):this.localforageSerializer=localforageSerializer}).call(window)},{}],69:[function(_hreq__,module){(function(global){var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var r,i=0;16>i;i++)0===(3&i)&&(r=4294967296*Math.random()),_rnds[i]=r>>>((3&i)<<3)&255;return _rnds}}module.exports=rng}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],70:[function(_hreq__,module){function parse(s,buf,offset){var i=buf&&offset||0,ii=0;for(buf=buf||[],s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){16>ii&&(buf[i+ii++]=_hexToByte[oct])});16>ii;)buf[i+ii++]=0;return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}function v1(options,buf,offset){var i=buf&&offset||0,b=buf||[];options=options||{};var clockseq=void 0!==options.clockseq?options.clockseq:_clockseq,msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(0>dt&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(0>dt||msecs>_lastMSecs)&&void 0===options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=(1e4*(268435455&msecs)+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var node=options.node||_nodeId,n=0;6>n;n++)b[i+n]=node[n];return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"==options?new Array(16):null,options=null),options=options||{};var rnds=options.random||(options.rng||_rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;16>ii;ii++)buf[i+ii]=rnds[ii];return buf||unparse(rnds)}for(var _rng=_hreq__(69),_byteToHex=[],_hexToByte={},i=0;256>i;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,module.exports=uuid},{69:69}],71:[function(_hreq__,module){"use strict";function XDLS(options){if(this.origin=options.origin,this.path=options.path,this.ready=!1,this.queue=[],this.messageId=0,this.callbacks={},this.instanceId=_instanceId++,!this.origin||!this.path)throw new Error("XDLS needs both an origin and a path specified in the constructor options.");for(var i=0;i<METHODS.length;++i)this[METHODS[i]]=this._handleMethod.bind(this,METHODS[i]);("undefined"==typeof options.init||options.init)&&this.init()}module.exports=XDLS;var md5=_hreq__(73),dataset=_hreq__(72),PREFIX="xdls:",METHODS=["clear","getItem","key","keys","length","removeItem","setItem"],_instanceId=0;XDLS.prototype.init=function(){var self=this;if(!self._iframe){if(!window.postMessage||!window.JSON)throw new Error("XDLS requires both postMossage and JSON support.");var onLoaded=self._onLoaded.bind(self),onMessage=self._onMessage.bind(self),iframeID="xdls-"+md5.digest_s(self.origin+self.path),existingIframe=document.getElementById(iframeID);if(existingIframe?(self._iframe=existingIframe,dataset(self._iframe,"loaded")&&onLoaded()):(self._iframe=document.createElement("iframe"),self._iframe.id=iframeID,self._iframe.setAttribute("sandbox","allow-scripts allow-same-origin"),dataset(self._iframe,"origin",self.origin),dataset(self._iframe,"path",self.path),self._iframe.style.cssText="width:1px; height:1px; display: none;",function _addIframe(){return document.body?void document.body.appendChild(self._iframe):void setTimeout(_addIframe,100)}()),window.addEventListener)self._iframe.addEventListener("load",onLoaded,!1),window.addEventListener("message",onMessage,!1);else{if(!self._iframe.attachEvent)throw new Error("XDLS could not properly bind for event handling.");self._iframe.attachEvent("onload",onLoaded,!1),window.attachEvent("onmessage",onMessage)}existingIframe||(self._iframe.src=self.origin+self.path)}},XDLS.prototype._onLoaded=function(){var self=this;self.ready=!0,dataset(self._iframe,"loaded",!0);for(var message;message=self.queue.shift();)self._sendMessage(message)},XDLS.prototype._handleMethod=function(){var self=this,_args=Array.prototype.slice.call(arguments,0),method=_args.shift(),callback=null;self.init(),_args.length&&"function"==typeof _args[_args.length-1]&&(callback=_args.pop()),++self.messageId;var id=self.instanceId+"."+self.messageId;callback&&(self.callbacks[id]=callback);var message={id:id,method:method,arguments:_args};self.ready?self._sendMessage(message):self.queue.push(message)},XDLS.prototype._sendMessage=function(message){var self=this;self._iframe.contentWindow.postMessage(PREFIX+JSON.stringify(message),self.origin)},XDLS.prototype._onMessage=function(event){var self=this;if(event.origin&&-1!==self.origin.indexOf(event.origin)&&event.data&&0===event.data.indexOf(PREFIX)){var data=JSON.parse(event.data.substring(PREFIX.length));self.callbacks[data.id]&&(data.error?self.callbacks[data.id](data):self.callbacks[data.id](null,data.result),delete self.callbacks[data.id])}}},{72:72,73:73}],72:[function(_hreq__,module){function toDashed(name){return name.replace(/([A-Z])/g,function(u){return"-"+u.toLowerCase()})}function dataset(node,attr,value){function set(attr,value){return fn.set(node,attr,value),self}function del(attr){return fn.del(node,attr),self}function get(attr){return fn.get(node,attr)}var self={set:set,get:get,del:del};return 3===arguments.length?set(attr,value):2==arguments.length?get(attr):self}module.exports=dataset;var fn;fn=document.head&&document.head.dataset?{set:function(node,attr,value){node.dataset[attr]=value},get:function(node,attr){return node.dataset[attr]},del:function(node,attr){delete node.dataset[attr]}}:{set:function(node,attr,value){node.setAttribute("data-"+toDashed(attr),value)},get:function(node,attr){return node.getAttribute("data-"+toDashed(attr))},del:function(node,attr){node.removeAttribute("data-"+toDashed(attr))}}},{}],73:[function(_hreq__,module,exports){!function(){"use strict";exports.digest=function(M){function F(x,y,z){return x&y|~x&z}function G(x,y,z){return x&z|y&~z}function H(x,y,z){return x^y^z}function I(x,y,z){return y^(x|~z)}function to4bytes(n){return[255&n,n>>>8&255,n>>>16&255,n>>>24&255]}function rounds(a,b,c,d,k,s,t,f){a[0]+=f(b[0],c[0],d[0])+X[k]+t,a[0]=a[0]<<s|a[0]>>>32-s,a[0]+=b[0]}var originalLength,i,j,k,l,A,B,C,D,AA,BB,CC,DD,X,rval;for(originalLength=M.length,M.push(128),l=56-M.length&63,i=0;l>i;i++)M.push(0);for(to4bytes(8*originalLength).forEach(function(e){M.push(e)}),[0,0,0,0].forEach(function(e){M.push(e)}),A=[1732584193],B=[4023233417],C=[2562383102],D=[271733878],i=0;i<M.length;i+=64){for(X=[],j=0;64>j;j+=4)k=i+j,X.push(M[k]|M[k+1]<<8|M[k+2]<<16|M[k+3]<<24);AA=A[0],BB=B[0],CC=C[0],DD=D[0],rounds(A,B,C,D,0,7,3614090360,F),rounds(D,A,B,C,1,12,3905402710,F),rounds(C,D,A,B,2,17,606105819,F),rounds(B,C,D,A,3,22,3250441966,F),rounds(A,B,C,D,4,7,4118548399,F),rounds(D,A,B,C,5,12,1200080426,F),rounds(C,D,A,B,6,17,2821735955,F),rounds(B,C,D,A,7,22,4249261313,F),rounds(A,B,C,D,8,7,1770035416,F),rounds(D,A,B,C,9,12,2336552879,F),rounds(C,D,A,B,10,17,4294925233,F),rounds(B,C,D,A,11,22,2304563134,F),rounds(A,B,C,D,12,7,1804603682,F),rounds(D,A,B,C,13,12,4254626195,F),rounds(C,D,A,B,14,17,2792965006,F),rounds(B,C,D,A,15,22,1236535329,F),rounds(A,B,C,D,1,5,4129170786,G),rounds(D,A,B,C,6,9,3225465664,G),rounds(C,D,A,B,11,14,643717713,G),rounds(B,C,D,A,0,20,3921069994,G),rounds(A,B,C,D,5,5,3593408605,G),rounds(D,A,B,C,10,9,38016083,G),rounds(C,D,A,B,15,14,3634488961,G),rounds(B,C,D,A,4,20,3889429448,G),rounds(A,B,C,D,9,5,568446438,G),rounds(D,A,B,C,14,9,3275163606,G),rounds(C,D,A,B,3,14,4107603335,G),rounds(B,C,D,A,8,20,1163531501,G),rounds(A,B,C,D,13,5,2850285829,G),rounds(D,A,B,C,2,9,4243563512,G),rounds(C,D,A,B,7,14,1735328473,G),rounds(B,C,D,A,12,20,2368359562,G),rounds(A,B,C,D,5,4,4294588738,H),rounds(D,A,B,C,8,11,2272392833,H),rounds(C,D,A,B,11,16,1839030562,H),rounds(B,C,D,A,14,23,4259657740,H),rounds(A,B,C,D,1,4,2763975236,H),rounds(D,A,B,C,4,11,1272893353,H),rounds(C,D,A,B,7,16,4139469664,H),rounds(B,C,D,A,10,23,3200236656,H),rounds(A,B,C,D,13,4,681279174,H),rounds(D,A,B,C,0,11,3936430074,H),rounds(C,D,A,B,3,16,3572445317,H),rounds(B,C,D,A,6,23,76029189,H),rounds(A,B,C,D,9,4,3654602809,H),rounds(D,A,B,C,12,11,3873151461,H),rounds(C,D,A,B,15,16,530742520,H),rounds(B,C,D,A,2,23,3299628645,H),rounds(A,B,C,D,0,6,4096336452,I),rounds(D,A,B,C,7,10,1126891415,I),rounds(C,D,A,B,14,15,2878612391,I),rounds(B,C,D,A,5,21,4237533241,I),rounds(A,B,C,D,12,6,1700485571,I),rounds(D,A,B,C,3,10,2399980690,I),rounds(C,D,A,B,10,15,4293915773,I),rounds(B,C,D,A,1,21,2240044497,I),rounds(A,B,C,D,8,6,1873313359,I),rounds(D,A,B,C,15,10,4264355552,I),rounds(C,D,A,B,6,15,2734768916,I),rounds(B,C,D,A,13,21,1309151649,I),rounds(A,B,C,D,4,6,4149444226,I),rounds(D,A,B,C,11,10,3174756917,I),rounds(C,D,A,B,2,15,718787259,I),rounds(B,C,D,A,9,21,3951481745,I),A[0]+=AA,B[0]+=BB,C[0]+=CC,D[0]+=DD}return rval=[],to4bytes(A[0]).forEach(function(e){rval.push(e)}),to4bytes(B[0]).forEach(function(e){rval.push(e)}),to4bytes(C[0]).forEach(function(e){rval.push(e)}),to4bytes(D[0]).forEach(function(e){rval.push(e)}),rval},exports.digest_s=function(s){var i,d,rstr,s,M=[];for(i=0;i<s.length;i++)M.push(s.charCodeAt(i));return d=exports.digest(M),rstr="",d.forEach(function(e){for(s=e.toString(16);s.length<2;)s="0"+s;rstr+=s}),rstr}}()},{}],74:[function(_hreq__,module){(function(Buffer){"use strict";function Auth(hone){var self=this;EventEmitter.call(self),self.hone=hone}function noop(){}function base64(str){return"undefined"!=typeof Buffer?new Buffer(str).toString("base64"):btoa(str)}var ajaja=_hreq__(2),antisync={series:_hreq__(10),parallel:_hreq__(9)},EventEmitter=_hreq__(51).EventEmitter2,extend=_hreq__(52),diff=_hreq__(49).diff;module.exports=Auth,Auth.prototype=Object.create(EventEmitter.prototype,{}),Auth.prototype._onUserLogin=function(user,callback){var self=this,existingUser=self.hone.state.get("user");user?user&&existingUser&&existingUser._id===user._id&&diff(existingUser,user)?(self.hone.state.set("user",user),self.hone.xdls.setItem("user",user),self.emit("user_updated",{old:existingUser,user:user})):user&&existingUser&&existingUser._id!==user._id?(self.emit("logout",{user:existingUser}),self.hone.state.set("user",user),self.hone.xdls.setItem("user",user),self.emit("login",{user:user})):user&&!existingUser&&(self.hone.state.set("user",user),self.hone.xdls.setItem("user",user),self.emit("login",{user:user})):(self.hone.state.set("user",null),self.hone.state.set("authtoken",null),self.hone.xdls.removeItem("user"),self.hone.xdls.removeItem("authtoken"),existingUser&&self.emit("logout",{user:existingUser})),callback&&callback()},Auth.prototype.getUser=function(callback,force){function _getUserAuthoritative(){ajaja({method:"GET",url:self.hone.url(self.hone.api.users.me)},function(error,user){return error&&400!=error.code?void callback(error):(self._onUserLogin(user),void callback(null,user))})}var self=this,existingUser=self.hone.state.get("user");return!force&&existingUser?void callback(null,existingUser):(force||(self.hone.xdls.getItem("user",function(error,user){if(!error){var existingUser=self.hone.state.get("user");existingUser||user&&(self.hone.state.set("user",user),self.emit("login",{user:user}))}}),self.hone.xdls.getItem("authtoken",function(error,authtoken){if(!error){var existingUser=self.hone.state.get("user");existingUser||self.hone.state.set("authtoken",authtoken)}})),void(self.hone.api?_getUserAuthoritative():self.hone.once("api_loaded",_getUserAuthoritative)))},Auth.prototype.signup=function(options,callback){var self=this;callback=callback||noop;var data=extend({},options),person=null,user=null;antisync.series([function(next){self.hone.getPerson(function(error,_person){return error?void next(error):(person=_person,void next())})},function(next){ajaja({url:self.hone.url(self.hone.api.users.create),method:"POST",headers:{"hone-anonymous-id":person?person.id:null,"person-id":person?person.id:null},data:data},function(error,_user){user=error?null:_user,next(error)})},function(next){self._onUserLogin(user,next)}],function(error){return error?(callback(error),void self.emit("error",error)):(self.emit("signup",{user:user}),void callback(null,user))})},Auth.prototype.logout=function(callback){var self=this;callback=callback||noop;var existingUser=self.hone.state.get("user");existingUser&&ajaja({url:self.hone.url(self.hone.api.sessions.session),method:"DELETE"},function(error){return error?(callback(error),void self.emit("error",error)):(self.hone.state.set("user",null),self.hone.state.set("authtoken",null),void antisync.parallel([self.hone.xdls.removeItem.bind(self.hone.xdls,"user"),self.hone.xdls.removeItem.bind(self.hone.xdls,"authtoken")],function(error){return error?(self.emit("error",error),void callback(error)):(self.emit("logout",{user:existingUser}),void callback())}))})},Auth.prototype.requestLoginCode=function(options,callback){var self=this;callback=callback||noop,ajaja({url:self.hone.url(self.hone.api.sessions.logincode),method:"POST",data:options},callback)},Auth.prototype.login=function(options,callback){var self=this,authorization=null,person=null;callback=callback||noop,antisync.series([function(next){if(options.facebook&&options.facebook.token)authorization="Facebook "+base64(options.facebook.id+":"+options.facebook.token);else if(options.phone)authorization="Phone "+base64(options.phone+":"+options.code);else{if(!options.email)return void next("No valid login method.");authorization="Email "+base64(options.email+":"+options.code)}next()},function(next){self.hone.getPerson(function(error,_person){return error?void next(error):(person=_person,void next())})},function(next){ajaja({url:self.hone.url(self.hone.api.sessions.session),method:"POST",headers:{Authorization:authorization,"hone-anonymous-id":person?person._id:null,"person-id":person?person._id:null},data:{}},function(error,response){if(error)return void next(error);var existingUser=self.hone.state.get("user");existingUser&&(self.hone.state.set("user",null),self.emit("logout",{user:existingUser}));var user=response.user;self.hone.state.set("user",user),self.hone.state.set("authtoken",response.authtoken),self.hone.xdls.setItem("user",user),self.hone.xdls.setItem("authtoken",response.authtoken),self.emit("login",{user:user}),next()})}],callback)},Auth.prototype.updateUser=function(data,callback){var self=this;callback=callback||noop;var user=self.hone.state.get("user");return user?void ajaja({url:self.hone.url(self.hone.api.users.user.replace("{{id}}",user._id)),method:"PUT",headers:{"hone-authtoken":self.hone.state.get("authtoken")},data:data},function(error,updatedUser){if(error)return void callback(error);var oldUser=user;self.hone.state.set("user",updatedUser),self.emit("user_updated",{user:updatedUser,old:oldUser}),callback(null,{user:updatedUser,old:user})}):void callback("No user is logged in!",null)}}).call(this,_hreq__(15).Buffer)},{10:10,15:15,2:2,49:49,51:51,52:52,9:9}],75:[function(_hreq__,module){"use strict";function DataStore(hone){var self=this;EventEmitter.call(self),self.hone=hone,self.cache={},self.readCache={}}function noop(){}var ajaja=_hreq__(2),antisync={series:_hreq__(10)},EventEmitter=_hreq__(51).EventEmitter2,extend=_hreq__(52),diff=_hreq__(49).diff;module.exports=DataStore,DataStore.prototype=Object.create(EventEmitter.prototype,{}),DataStore.prototype._cacheObject=function(key,obj,readonlyObj){var self=this;self.readCache[key]=extend(!0,{},"undefined"!=typeof readonlyObj?readonlyObj:obj),self.cache[key]=obj},DataStore.prototype._decorateObject=function(obj,type,key){var self=this;obj.__type=type,obj.__key=key,obj.save=self._save.bind(self,obj),obj.delete=self._delete.bind(self,obj),obj.bare=self._bare.bind(self,obj)},DataStore.prototype.create=function(opts,callback){var self=this,saveObject="undefined"!=typeof opts.save?opts.save:!1,cacheObject="undefined"!=typeof opts.cache?opts.cache:!0,decorateObject="undefined"!=typeof opts.decorate?opts.decorate:!0,obj=self.hone.objectFactory.create(opts.type.toLowerCase());extend(obj,opts.data);var key=opts.type+":"+obj._id;cacheObject&&self._cacheObject(key,obj,{}),decorateObject&&self._decorateObject(obj,opts.type,key),antisync.series([function(next){return saveObject?void ajaja({method:"POST",url:self.hone.url("/api/2.0/store/"+opts.type),data:opts.data},function(error,_obj){if(error)return void next(error);var key=opts.type+":"+_obj._id;cacheObject&&self._cacheObject(key,_obj),decorateObject&&self._decorateObject(_obj,opts.type,key),obj=_obj,next()}):void next()}],function(error){return error?void callback(error,obj):(callback(null,obj),void self.emit("create",{type:opts.type,id:obj._id,obj:obj,saved:saveObject,cached:cacheObject,decorated:decorateObject}))})},DataStore.prototype.get=function(opts,callback){var self=this;if(opts.id&&opts.query||!opts.id&&!opts.query)return void callback({error:"invalid query",message:"You must specify either an id or a query."});var key=null;if(opts.id&&(key=opts.type+":"+opts.id,!opts.force&&self.cache[key]))return self.emit("get",{type:opts.type,id:opts.id,result:self.cache[key]}),void callback(null,self.cache[key]);var fetchOptions={method:"GET",url:self.hone.url("/api/2.0/store/"+opts.type)+(opts.id?"/"+opts.id:""),data:opts.data||{}};if(opts.query){var prevToJSON=RegExp.prototype.toJSON;RegExp.prototype.toJSON=function(){return"!!RE:"+this.toString()},fetchOptions.data.query=JSON.stringify(opts.query),opts.view&&(fetchOptions.data.view=JSON.stringify(opts.view)),RegExp.prototype.toJSON=prevToJSON}ajaja(fetchOptions,function(error,result){if(error)return void callback(error);if(!opts.view)if(opts.id)self._cacheObject(key,result),self._decorateObject(result,opts.type,key);else if(Array.isArray(result))for(var i=0;i<result.length;++i){var obj=result[i],objKey=opts.type+":"+obj._id;self._cacheObject(objKey,obj),self._decorateObject(obj,opts.type,objKey)}self.emit("get",{type:opts.type,id:opts.id,query:opts.query,view:opts.view,result:result}),callback(null,result)})},DataStore.prototype.load=function(type,obj){var self=this,key=type+":"+obj._id;return self._cacheObject(key,obj),self._decorateObject(obj,type,key),obj},DataStore.prototype._save=function(obj,callback){var self=this;callback=callback||noop;var key=obj.__type+":"+obj._id,base=self.readCache[key],bare=obj.bare(),changes=diff(base,bare);return changes?void ajaja({method:"PUT",url:self.hone.url("/api/2.0/store/"+obj.__type+"/"+obj._id),data:changes},function(error,_obj){if(error)return void callback(error);self._cacheObject(key,obj,_obj),extend(obj,_obj);var changeObj={type:obj.__type,id:obj._id,result:obj,changes:changes};self.emit("save",changeObj),self.emit("change",changeObj),self.emit("change."+obj.__type,changeObj),self.emit("change."+obj.__type+"."+obj._id,changeObj),callback(null,obj)}):void callback(null,obj)},DataStore.prototype._delete=function(obj,callback){var self=this;callback=callback||noop;var type=obj.__type,id=obj._id,key=obj.__key;ajaja({method:"DELETE",url:self.hone.url("/api/2.0/store/"+type+"/"+id)},function(error){if(error)return self._decorateObject(obj,type,key),void callback(error);delete self.readCache[key],delete self.cache[key];var event={type:type,id:id};self.emit("delete",event),callback()})},DataStore.prototype._bare=function(obj){var bare=extend(!0,{},obj);delete bare.__type,delete bare.__key,delete bare.save,delete bare.delete,delete bare.bare;for(var key in bare)bare.hasOwnProperty(key)&&0===key.indexOf("__")&&delete bare[key];return bare}},{10:10,2:2,49:49,51:51,52:52}],76:[function(_hreq__,module){"use strict";function Id(hone){var self=this;EventEmitter.call(self),self.hone=hone,self._getUniqueId(function(error,uniqueId){return error?void self.emit("error",error):uniqueId?(self.hone.state.set("uniqueId",uniqueId),void self.emit("identified",{id:uniqueId})):void self.emit("warning","Could not determine unique id at startup.")})}var EventEmitter=_hreq__(51).EventEmitter2,ubid=_hreq__(53);module.exports=Id,Id.prototype=Object.create(EventEmitter.prototype,{}),Id.prototype._getUniqueId=function(callback){var self=this,output=self.hone.state.get("uniqueId");return output?void callback():void ubid.get(function(error,data){return error?void callback(error):(self.hone.state.set("uniqueId",data.random.signature),void callback(null,data.random.signature))},self.hone.xdls)}},{51:51,53:53}],77:[function(_hreq__,module){"use strict";function IFrameSizer(eventBus){var self=this;EventEmitter.call(self),self.eventBus=eventBus,self.eventBus.on("rendered",self.onRendered.bind(self))}var EventEmitter=_hreq__(51).EventEmitter2;module.exports=IFrameSizer,IFrameSizer.prototype=Object.create(EventEmitter.prototype,{}),IFrameSizer.prototype.onRendered=function(event,postMessageEvent){var iframes=Array.prototype.slice.call(document.querySelectorAll("iframe[data-resize]"),0);iframes.forEach(function(iframe){if(iframe.contentWindow===postMessageEvent.source){var resizeDimensions={};iframe.dataset.resize.split(",").forEach(function(dimension){resizeDimensions[dimension.toLowerCase()]=!0}),(resizeDimensions.true||resizeDimensions.width)&&(iframe.style.width=event.scrollWidth+"px"),(resizeDimensions.true||resizeDimensions.height)&&(iframe.style.height=event.scrollHeight+"px")
}})}},{51:51}],78:[function(_hreq__,module){"use strict";module.exports={id:_hreq__(48)}},{48:48}],79:[function(_hreq__,module){"use strict";function _addTimestamps(obj){var now=new Date;return obj.createdAt=obj.updatedAt=now,obj}var ObjectID=_hreq__(48);module.exports={create:function(type){var creator=creators[type];if(!creator)throw new Error("Unknown type: "+type);return creator()}};var creators={auditlogentry:function(){return _addTimestamps({_id:new ObjectID,user:null,action:null,model:null,id:null,data:null})},gitHubcommit:function(){return _addTimestamps({_id:new ObjectID,branch:null,hash:null})},user:function(){return _addTimestamps({_id:new ObjectID,email:null,nickname:null,location:null,bio:null,photo:null,organization:null,organizationLink:null,verified:!0,xp:0,level:1,sentInvites:0,acceptedInvites:0,admin:!1,critic:!1,facebook:{id:null},firstname:null,lastname:null,gender:null,birthYear:null,birthMonth:null,birthDay:null,phone:null,addressLine1:null,addressLine2:null,city:null,state:null,country:null,zip:null})},person:function(){return _addTimestamps({_id:new ObjectID,id:null,user:null,email:null,facebook:{id:null},nickname:null,firstname:null,lastname:null,gender:null,birthYear:null,birthMonth:null,birthDay:null,phone:null,geo:{country:null,region:null,city:null,addressLine1:null,addressLine2:null,location:{type:null,coordinates:void 0},zip:null},lastSeen:new Date})},preferences:function(){return _addTimestamps({_id:new ObjectID,data:{}})},authtoken:function(){return _addTimestamps({_id:new ObjectID,user:null,token:null,capability:null,expires:null})},team:function(){return _addTimestamps({_id:new ObjectID,user:null,name:null,photo:null,members:[]})},template:function(){return _addTimestamps({_id:new ObjectID,user:null,team:null,public:!1,quiz:null,question:null,lastUsed:new Date})},events:function(){return _addTimestamps({_id:new ObjectID,eventName:null,data:{}})},invite:function(){return _addTimestamps({_id:new ObjectID,user:null,email:null,expiresAt:null,acceptedAt:null})},question:function(){return _addTimestamps({_id:new ObjectID,user:null,team:null,hidden:!0,question:null,description:null,caption:null,signupPitch:null,photo:{url:null,preview:null,x:null,y:null,scale:null,caption:null},tags:[],hiddenTags:[],agreements:[],startsAt:null,endsAt:null,completedAt:null,deletedAt:null,featured:!1,css:null,confirmVoteExtraInfo:null,answered:{content:null,email:{from:{address:null,verified:!1},subject:null,text:null,html:null}},sharing:{url:null,content:null,twitter:{content:null,photo:null},facebook:{title:null,content:null,photo:null},pinterest:{content:null,photo:null},email:{content:null}},signupButtonText:null,source:null,curated:!1,reward:!1,related:[],allowAnonymousVotes:!0,refreshAfterVote:!1,logoutAfterVote:!1,next:null,skipPostVote:!1,postVoteResults:!1,styling:{voteButton:{background:null,color:null},buyButton:{background:null,color:null},title:{background:null,color:null},itemTitle:{background:null,color:null},body:{background:null,color:null}},itemDetails:!1,acceptingVotes:!0,showCritiquesOnMainPage:!1,showTags:!1,postbackURL:null,showRelated:!1,confirmVotes:!1,randomizeItemOrder:!1,gatherDemographics:!1,requireFullUserInfo:!1,fullUserInfoRequirementExplanation:null,showHeader:!0,theme:null,items:[],template:{enabled:!1,name:null,public:!1},sponsor:{url:null,name:null,logo:null},quiz:null})},item:function(){return _addTimestamps({_id:new ObjectID,title:null,price:null,content:null,media:[],critiques:[],tags:[],hiddenTags:[],chooseAction:null,link:null,linkAction:null,deletedAt:null,postVotePitch:null,next:null,skipPostVote:!1,styling:{voteButton:{background:null,color:null},buyButton:{background:null,color:null},title:{background:null,color:null}},adItem:!1})},photo:function(){return _addTimestamps({_id:new ObjectID,url:null,preview:null,x:null,y:null,scale:null,caption:null})},critique:function(){_addTimestamps({_id:new ObjectID,user:null,content:null,sentiment:null})},quiz:function(){return _addTimestamps({_id:new ObjectID,user:null,team:null,title:null,photo:{url:null,preview:null,x:null,y:null,scale:null,caption:null},description:null,outcomes:[],questions:[],tags:[],hiddenTags:[],css:null,theme:null,endsAt:null,deletedAt:null,sharing:{content:null,twitter:{content:null,photo:null},facebook:{title:null,content:null,photo:null},pinterest:{content:null,photo:null},email:{content:null}},sponsor:{url:null,name:null,logo:null},template:{enabled:!1,name:null,public:!1},templateId:null,dataCollection:{form:null,position:-1,description:null,action:null,successMessage:null},conversion:null})},outcome:function(){return _addTimestamps({_id:new ObjectID,title:null,content:null,photo:null,caption:null,css:null,description:null,less:null,tags:[],sharing:{url:null,content:null,twitter:{content:null,photo:null},facebook:{title:null,content:null,photo:null},pinterest:{content:null,photo:null},email:{content:null}},sponsor:{url:null,name:null,logo:null}})},form:function(){return _addTimestamps({_id:new ObjectID,fields:[],title:null})},formfield:function(){return{_id:new ObjectID,name:null,type:"text",placeholder:null,validation:!0,required:!0}},datacollection:function(){return _addTimestamps({_id:new ObjectID,data:[],formId:null,refId:null})},vote:function(){return _addTimestamps({_id:new ObjectID,user:null,anonymous_id:null,question:null,item:null,quiz:null,meta:{gender:null,age:null,device:null,browser:null,os:null},ip:null,agreed:!1,geo:{country:null,region:null,city:null,location:{type:null,coordinates:void 0},zip:null}})},quizvote:function(){return _addTimestamps({_id:new ObjectID,user:null,anonymous_id:null,votes:{}})},affinity:function(){return _addTimestamps({_id:new ObjectID,user:null,affinity:null,value:0})},rewardentry:function(){return _addTimestamps({_id:new ObjectID,question:null,user:null,reason:null,related:{obj:null,objType:null}})},agreement:function(){return _addTimestamps({_id:new ObjectID,question:null,user:null,agreed:!0})},socialshare:function(){return _addTimestamps({_id:new ObjectID,user:null,service:null,url:null,quiz:null,question:null,item:null,vote:null})},emails:function(){return _addTimestamps({_id:new ObjectID,question:null,items:[],subject:null,targetcount:0,body:null,sent:0,opened:0,marked_spam:0,rejected:0,clicked:0,unsubscribed:0,hard_bounced:0,soft_bounced:0})},postback:function(){return _addTimestamps({_id:new ObjectID,quiz:null,question:null,url:null,result:null})},theme:function(){return _addTimestamps({_id:new ObjectID,owner:null,theme_name:null,thumbnail:null,css:{embedded:null,adunit:null},blocks:[],public:!1,outcome:null,baseTheme:null})},themeblock:function(){return{_id:new ObjectID,type:"embedded",width:null,height:null,css:""}}}},{48:48}],80:[function(_hreq__,module){"use strict";function Preferences(hone){var self=this;EventEmitter.call(self),self.hone=hone,self.loaded=!1,self._preferences=null,self.hone.on("auth.login",self.onLogin.bind(self)),self.hone.on("auth.logout",self.onLogout.bind(self))}var ajaja=_hreq__(2),Delver=_hreq__(50),EventEmitter=_hreq__(51).EventEmitter2;module.exports=Preferences,Preferences.prototype=Object.create(EventEmitter.prototype,{}),Preferences.prototype.onLogin=function(event){var self=this;return self.hone.api?void ajaja({url:self.hone.url(self.hone.api.preferences.prefs.replace("{{userid}}",event.user._id)),method:"GET"},function(error,preferences){return error?void self.emit("error",error):(self._preferences=preferences,self._preferences.data=self._preferences.data||{},self.loaded=!0,void self.emit("loaded",{preferences:self._preferences.data}))}):void self.hone.once("api_loaded",self.onLogin.bind(self,event))},Preferences.prototype.onLogout=function(){var self=this;self._preferences=null,self.loaded=!1,self.emit("unloaded")},Preferences.prototype.update=function(data,callback){var self=this,user=self.hone.state.get("user");return user?void ajaja({url:self.hone.url(self.hone.api.preferences.prefs.replace("{{userid}}",user._id)),method:"PUT",data:data},function(error,_preferences){error||(self._preferences=_preferences,self.emit("updated")),callback(error)}):void callback("No user is logged in.")},Preferences.prototype.get=function(key,_default){var self=this;if(!self._preferences)throw new Error("No current preferences loaded.");return Delver.get(self._preferences.data,key,_default)},Preferences.prototype.set=function(key,value){var self=this;if(!self._preferences)throw new Error("No current preferences loaded.");var data={};return data[key]=value,self.update(data,function(error){return error?void self.emit("error",error):void 0}),Delver.set(self._preferences.data,key,value)}},{2:2,50:50,51:51}],81:[function(_hreq__,module){"use strict";function Registration(hone){var self=this;EventEmitter.call(self),self.hone=hone,self._registering=!1,setTimeout(self.register.bind(self),0)}function noop(){}var antisync={series:_hreq__(10),waterfall:_hreq__(13)},EventEmitter=_hreq__(51).EventEmitter2,extend=_hreq__(52);module.exports=Registration,Registration.prototype=Object.create(EventEmitter.prototype,{}),Registration.prototype.getPerson=function(callback){function _getPerson(){self.hone.xdls.getItem("person",function(error,person){antisync.series([function(next){return person?(self.hone.load("person",person),void next()):void self.hone.create({type:"person"},function(error,_person){return error?void next(error):(person=_person,person.id=self.hone.state.get("uniqueId"),void next())})}],function(error){return error?void callback(error):void callback(null,person)})})}var self=this,existingPerson=self.hone.state.get("person");return existingPerson?void callback(null,existingPerson):void(self.hone.state.get("uniqueId")?_getPerson():self.hone.once("id.identified",_getPerson))},Registration.prototype._savePerson=function(person,callback){person.save(function(error){callback(error,person)})},Registration.prototype.register=function(person,callback){var self=this;return self._registering?void self.once("registered",function(){self.register(person,callback)}):(self._registering=!0,person=person||{},callback=callback||noop,void antisync.waterfall([self.getPerson.bind(self),function(_person,next){extend(_person,person),_person.lastSeen=new Date,next(null,_person)},self._savePerson.bind(self)],function(error,_person){return error?(self._registering=!1,void callback(error)):(self.hone.state.set("person",_person),self.hone.xdls.setItem("person",_person.bare()),self._registering=!1,callback(),void self.emit("registered",{person:_person}))}))},Registration.prototype.unregister=function(callback){var self=this;callback=callback||noop,self.hone.state.set("person",null),self.hone.xdls.setItem("person",null),callback(),self.emit("unregistered")}},{10:10,13:13,51:51,52:52}],82:[function(_hreq__,module){"use strict";function State(){var self=this;if(1!==arguments.length)throw new Error("State requires a state container object as its one and only arugment.");Delver.apply(self,arguments)}var Delver=_hreq__(50);State.prototype=Object.create(Delver.prototype,{}),State.singleton=State.singleton||new State({}),State.singleton.State=State,module.exports=State.singleton},{50:50}],83:[function(_hreq__,module){"use strict";function Teams(hone){var self=this;self.hone=hone}module.exports=Teams,Teams.prototype.getByUser=function(user,callback){var self=this,userTeamsKey="user.teams."+user._id,teams=self.hone.state.get(userTeamsKey);return"undefined"!=typeof teams?void callback(null,teams):void self.hone.get({type:"Team",query:'user == "'+user._id+'" or "'+user._id+'" in members'},function(error,_teams){return error?void callback(error):(self.hone.state.set(userTeamsKey,_teams),void callback(null,_teams))})}},{}]},{},[1])(1)});
//# sourceMappingURL=hone.min.js.map